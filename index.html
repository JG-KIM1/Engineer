<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì´íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ 2025</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ë¡œê·¸ì¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(10px);
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-size: 28px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.9);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        .demo-accounts {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 8px;
            font-size: 14px;
            color: #6c757d;
            border-left: 4px solid #667eea;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            color: #333;
            padding: 15px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-links {
            display: flex;
            gap: 10px;
        }

        .nav-link {
            background: none;
            border: none;
            color: #333;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover, .nav-link.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            color: #667eea;
        }

        /* ë©”ì¸ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            min-height: calc(100vh - 120px);
        }

        .page-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #333;
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        /* ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-title {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .time-display {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 600;
            border-left: 4px solid #667eea;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            margin: 0 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.1);
        }

        .action-btn.delete:hover {
            background: rgba(220, 53, 69, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #6c757d;
            font-size: 18px;
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        /* í•„í„°ë§ ìŠ¤íƒ€ì¼ */
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        /* ì°¨íŠ¸ íƒ­ ìŠ¤íƒ€ì¼ */
        .chart-tabs, .stats-tabs, .register-tabs {
            display: flex;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px 10px 0 0;
            margin: -25px -25px 20px -25px;
            padding: 0;
            overflow-x: auto;
        }

        .chart-tab, .stats-tab, .register-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 140px;
        }

        .chart-tab.active, .stats-tab.active, .register-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            transform: translateY(-2px);
        }

        .chart-tab:hover:not(.active), .stats-tab:hover:not(.active), .register-tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        /* ì§€ì› íƒ€ì… ë°°ì§€ */
        .support-type-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            display: inline-block;
        }

        .support-type-badge.ì •ê¸°ì ê²€ {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .support-type-badge.ê¸°ìˆ ì§€ì› {
            background: linear-gradient(135deg, #007bff, #6610f2);
            color: white;
        }

        .support-type-badge.ì¥ì• ì§€ì› {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
        }

        /* ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ */
        .data-management-section {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid #2196f3;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .data-management-title {
            font-size: 20px;
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .data-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .data-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .data-btn.save {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .data-btn.load {
            background: linear-gradient(135deg, #007bff, #6610f2);
            color: white;
        }

        .data-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .data-status {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .data-status.success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #28a745;
        }

        .data-status.error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .data-status.info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border: 2px solid #17a2b8;
        }

        /* ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .upload-section {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, #f8f9ff, #e6f3ff);
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #5a67d8;
            background: linear-gradient(135deg, #f0f4ff, #dbeafe);
            transform: translateY(-2px);
        }

        .upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-tabs, .stats-tabs, .register-tabs {
                flex-direction: column;
            }
            
            .chart-tab, .stats-tab, .register-tab {
                border-radius: 0;
                border-bottom: 1px solid #dee2e6;
            }

            .navbar-content {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .data-buttons {
                flex-direction: column;
            }
        }

        /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .gap-10 {
            gap: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h2>ğŸ¢ ì‹œì˜¤ë© ë°±ì—…ì‚¬ì´íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ </h2>
            <div class="form-group">
                <label for="username">ğŸ‘¤ ì‚¬ìš©ìëª…</label>
                <input type="text" id="username" placeholder="ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label for="password">ğŸ”’ ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div id="loginError" class="error hidden"></div>
            <button class="btn" onclick="handleLogin()">ë¡œê·¸ì¸</button>
            
            <div class="demo-accounts">
                <strong>ğŸ”‘ í…ŒìŠ¤íŠ¸ ê³„ì •</strong><br>
                â€¢ admin / admin123 (ê´€ë¦¬ì)<br>
                â€¢ engineer1 / eng123 (ì—”ì§€ë‹ˆì–´)
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div id="mainApp" class="hidden">
        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="navbar">
            <div class="navbar-content">
                <div class="nav-links">
                    <button class="nav-link active" onclick="showPage('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
                    <button class="nav-link" onclick="showPage('register')">â• ì§€ì› ë“±ë¡</button>
                    <button class="nav-link" onclick="showPage('list')">ğŸ“‹ ì§€ì› ëª©ë¡</button>
                </div>
                <div class="user-info">
                    <span id="userWelcome">í™˜ì˜í•©ë‹ˆë‹¤</span>
                    <button class="nav-link" onclick="handleLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </nav>

        <div class="main-content">
            <!-- JSON ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="container">
                <div class="data-management-section">
                    <div class="data-management-title">
                        ğŸ’¾ ë°ì´í„° ë°±ì—… ë° ë³µì›
                    </div>
                    <div class="data-buttons">
                        <button class="data-btn save" onclick="saveDataToJSON()">
                            ğŸ’¾ ë°ì´í„° ì €ì¥ (JSON)
                        </button>
                        <button class="data-btn load" onclick="document.getElementById('jsonFileInput').click()">
                            ğŸ“ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (JSON)
                        </button>
                        <input type="file" id="jsonFileInput" class="file-input" accept=".json" onchange="loadDataFromJSON(event)">
                    </div>
                    <div id="dataStatus" class="data-status hidden"></div>
                </div>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
            <div id="dashboardPage" class="container">
                <h1 class="page-title">ğŸ“Š ì‹œì˜¤ë© ë°±ì—…ì‚¬ì´íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ </h1>
                
                <!-- í•„í„°ë§ ë° ê²€ìƒ‰ ì„¹ì…˜ -->
                <div class="card mb-20">
                    <div class="card-title">ğŸ” ê²€ìƒ‰ ë° í•„í„°ë§</div>
                    <div class="filter-grid">
                        <div class="form-group">
                            <label for="searchKeyword">ğŸ” í‚¤ì›Œë“œ ê²€ìƒ‰</label>
                            <input type="text" id="searchKeyword" placeholder="ì‚¬ì´íŠ¸ëª…, ì—”ì§€ë‹ˆì–´ëª… ê²€ìƒ‰" onchange="applyFilters()">
                        </div>
                        <div class="form-group">
                            <label for="filterEngineer">ğŸ‘¨â€ğŸ’» ì—”ì§€ë‹ˆì–´ í•„í„°</label>
                            <select id="filterEngineer" onchange="applyFilters()">
                                <option value="">ì „ì²´ ì—”ì§€ë‹ˆì–´</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterSite">ğŸ¢ ì‚¬ì´íŠ¸ í•„í„°</label>
                            <select id="filterSite" onchange="applyFilters()">
                                <option value="">ì „ì²´ ì‚¬ì´íŠ¸</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterSupportType">ğŸ› ï¸ ì§€ì› íƒ€ì… í•„í„°</label>
                            <select id="filterSupportType" onchange="applyFilters()">
                                <option value="">ì „ì²´ íƒ€ì…</option>
                                <option value="ì •ê¸°ì ê²€">ì •ê¸°ì ê²€</option>
                                <option value="ê¸°ìˆ ì§€ì›">ê¸°ìˆ ì§€ì›</option>
                                <option value="ì¥ì• ì§€ì›">ì¥ì• ì§€ì›</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterStartDate">ğŸ“… ì‹œì‘ ë‚ ì§œ</label>
                            <input type="date" id="filterStartDate" onchange="applyFilters()">
                        </div>
                        <div class="form-group">
                            <label for="filterEndDate">ğŸ“… ì¢…ë£Œ ë‚ ì§œ</label>
                            <input type="date" id="filterEndDate" onchange="applyFilters()">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="clearFilters()">ğŸ”„ í•„í„° ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">ğŸ“‹ ì´ ì§€ì› ê±´ìˆ˜</div>
                        <div class="stat-value" id="totalRecords">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">â° ì´ ì§€ì› ì‹œê°„</div>
                        <div class="stat-value" id="totalHours">0h</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ğŸ“Š í‰ê·  ì§€ì› ì‹œê°„</div>
                        <div class="stat-value" id="avgHours">0h</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ğŸ‘¥ í™œì„± ì—”ì§€ë‹ˆì–´ ìˆ˜</div>
                        <div class="stat-value" id="activeEngineers">0</div>
                    </div>
                </div>

                <!-- ì°¨íŠ¸ íƒ­ ì‹œìŠ¤í…œ -->
                <div class="card">
                    <div class="chart-tabs">
                        <button class="chart-tab active" onclick="showChartTab('monthly')">ğŸ“… ì›”ê°„ í†µê³„</button>
                        <button class="chart-tab" onclick="showChartTab('engineer')">ğŸ‘¨â€ğŸ’» ì—”ì§€ë‹ˆì–´ë³„</button>
                        <button class="chart-tab" onclick="showChartTab('supporttype')">ğŸ› ï¸ ì§€ì› íƒ€ì…ë³„</button>
                        <button class="chart-tab" onclick="showChartTab('site')">ğŸ¢ ì‚¬ì´íŠ¸ë³„</button>
                    </div>
                    
                    <div id="monthlyChartContainer" class="chart-tab-content">
                        <div class="card-title">ğŸ“… ì›”ê°„ ì‚¬ì´íŠ¸ë³„ ì§€ì› ì‹œê°„ í†µê³„</div>
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                    
                    <div id="engineerChartContainer" class="chart-tab-content hidden">
                        <div class="card-title">ğŸ‘¨â€ğŸ’» ì—”ì§€ë‹ˆì–´ë³„ ì§€ì› í†µê³„</div>
                        <div class="chart-container">
                            <canvas id="engineerChart"></canvas>
                        </div>
                    </div>
                    
                    <div id="supporttypeChartContainer" class="chart-tab-content hidden">
                        <div class="card-title">ğŸ› ï¸ ì§€ì› íƒ€ì…ë³„ ë¶„ì„</div>
                        <div class="chart-container">
                            <canvas id="supportTypeChart"></canvas>
                        </div>
                    </div>
                    
                    <div id="siteChartContainer" class="chart-tab-content hidden">
                        <div class="card-title">ğŸ¢ ì‚¬ì´íŠ¸ë³„ ì´ ì§€ì› ì‹œê°„ ë¶„í¬</div>
                        <div class="chart-container">
                            <canvas id="siteChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ìƒì„¸ í†µê³„ í˜„í™© -->
                <div class="card">
                    <div class="stats-tabs">
                        <button class="stats-tab active" onclick="showStatsTab('engineer')">ğŸ‘¨â€ğŸ’» ì—”ì§€ë‹ˆì–´ë³„ í†µê³„</button>
                        <button class="stats-tab" onclick="showStatsTab('site')">ğŸ¢ ì‚¬ì´íŠ¸ë³„ í†µê³„</button>
                        <button class="stats-tab" onclick="showStatsTab('supporttype')">ğŸ› ï¸ ì§€ì› íƒ€ì…ë³„ í†µê³„</button>
                    </div>
                    
                    <!-- ì—”ì§€ë‹ˆì–´ë³„ í†µê³„ íƒ­ -->
                    <div id="engineerStatsContainer" class="stats-tab-content">
                        <div class="card-title">ğŸ‘¨â€ğŸ’» ì—”ì§€ë‹ˆì–´ë³„ ìƒì„¸ í†µê³„</div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ì—”ì§€ë‹ˆì–´ëª…</th>
                                        <th>ì§€ì› ê±´ìˆ˜</th>
                                        <th>ì´ ì‹œê°„</th>
                                        <th>í‰ê·  ì‹œê°„</th>
                                        <th>ì •ê¸°ì ê²€</th>
                                        <th>ê¸°ìˆ ì§€ì›</th>
                                        <th>ì¥ì• ì§€ì›</th>
                                    </tr>
                                </thead>
                                <tbody id="engineerStatsBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- ì‚¬ì´íŠ¸ë³„ í†µê³„ íƒ­ -->
                    <div id="siteStatsContainer" class="stats-tab-content hidden">
                        <div class="card-title">ğŸ¢ ì‚¬ì´íŠ¸ë³„ ìƒì„¸ í†µê³„</div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ì‚¬ì´íŠ¸ëª…</th>
                                        <th>ì§€ì› ê±´ìˆ˜</th>
                                        <th>ì´ ì‹œê°„</th>
                                        <th>í‰ê·  ì‹œê°„</th>
                                        <th>ì°¸ì—¬ ì—”ì§€ë‹ˆì–´</th>
                                        <th>ì£¼ìš” ì§€ì› íƒ€ì…</th>
                                    </tr>
                                </thead>
                                <tbody id="siteStatsBody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ì§€ì› íƒ€ì…ë³„ í†µê³„ íƒ­ -->
                    <div id="supporttypeStatsContainer" class="stats-tab-content hidden">
                        <div class="card-title">ğŸ› ï¸ ì§€ì› íƒ€ì…ë³„ ìƒì„¸ í†µê³„</div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ì§€ì› íƒ€ì…</th>
                                        <th>ì§€ì› ê±´ìˆ˜</th>
                                        <th>ì´ ì‹œê°„</th>
                                        <th>í‰ê·  ì‹œê°„</th>
                                        <th>ì°¸ì—¬ ì—”ì§€ë‹ˆì–´</th>
                                        <th>ë¹„ìœ¨</th>
                                    </tr>
                                </thead>
                                <tbody id="supportTypeStatsBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì§€ì› ë“±ë¡ í˜ì´ì§€ -->
            <div id="registerPage" class="container hidden">
                <h1 class="page-title" id="registerTitle">â• ì‚¬ì´íŠ¸ ì§€ì› ë“±ë¡</h1>
                
                <div class="card">
                    <!-- ë“±ë¡ ë°©ë²• íƒ­ -->
                    <div class="register-tabs">
                        <button class="register-tab active" onclick="showRegisterTab('manual')">ğŸ“ ìˆ˜ë™ ë“±ë¡</button>
                        <button class="register-tab" onclick="showRegisterTab('excel')">ğŸ“„ ì—‘ì…€ ì—…ë¡œë“œ</button>
                    </div>

                    <!-- ìˆ˜ë™ ë“±ë¡ íƒ­ -->
                    <div id="manualRegisterContent" class="register-tab-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="siteName">ğŸ¢ ì§€ì› ì‚¬ì´íŠ¸ëª…</label>
                                <input type="text" id="siteName" placeholder="ì‚¬ì´íŠ¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            <div class="form-group">
                                <label for="engineerName">ğŸ‘¨â€ğŸ’» ì§€ì› ì—”ì§€ë‹ˆì–´ ì´ë¦„</label>
                                <input type="text" id="engineerName" placeholder="ì—”ì§€ë‹ˆì–´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                            <div class="form-group">
                                <label for="supportType">ğŸ› ï¸ ì§€ì› íƒ€ì…</label>
                                <select id="supportType">
                                    <option value="">ì§€ì› íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì •ê¸°ì ê²€">ì •ê¸°ì ê²€</option>
                                    <option value="ê¸°ìˆ ì§€ì›">ê¸°ìˆ ì§€ì›</option>
                                    <option value="ì¥ì• ì§€ì›">ì¥ì• ì§€ì›</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="startDate">ğŸ“… ì§€ì› ì‹œì‘ ë‚ ì§œ</label>
                                <input type="date" id="startDate">
                            </div>
                            <div class="form-group">
                                <label for="startTime">ğŸ• ì§€ì› ì‹œì‘ ì‹œê°„</label>
                                <input type="time" id="startTime">
                            </div>
                            <div class="form-group">
                                <label for="endDate">ğŸ“… ì§€ì› ì¢…ë£Œ ë‚ ì§œ</label>
                                <input type="date" id="endDate">
                            </div>
                            <div class="form-group">
                                <label for="endTime">ğŸ• ì§€ì› ì¢…ë£Œ ì‹œê°„</label>
                                <input type="time" id="endTime">
                            </div>
                        </div>

                        <div class="time-display">
                            <strong>â±ï¸ ì „ì²´ ì§€ì› ì‹œê°„: </strong><span id="calculatedHours">0</span> ì‹œê°„
                        </div>

                        <div class="flex gap-10">
                            <button class="btn" onclick="handleSubmitSupport()" id="submitBtn">ë“±ë¡</button>
                            <button class="btn btn-secondary hidden" onclick="handleCancelEdit()" id="cancelBtn">ì·¨ì†Œ</button>
                        </div>
                    </div>

                    <!-- ì—‘ì…€ ì—…ë¡œë“œ íƒ­ -->
                    <div id="excelRegisterContent" class="register-tab-content hidden">
                        <!-- í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ -->
                        <div class="mb-20">
                            <h3>ğŸ“‹ ì—‘ì…€ í…œí”Œë¦¿</h3>
                            <p>ì•„ë˜ í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë°ì´í„°ë¥¼ ì…ë ¥í•œ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</p>
                            <button class="upload-btn" onclick="downloadExcelTemplate()">
                                ğŸ“¥ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>

                        <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
                        <div class="upload-section" id="uploadSection">
                            <div>
                                <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“„</div>
                                <h3>ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h3>
                                <p>íŒŒì¼ì„ ëŒì–´ì„œ ë†“ê±°ë‚˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                                <input type="file" id="excelFileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFileUpload(event)">
                                <button class="upload-btn" onclick="document.getElementById('excelFileInput').click()">
                                    ğŸ“ íŒŒì¼ ì„ íƒ
                                </button>
                                <div style="margin-top: 15px; color: #6c757d; font-size: 14px;">
                                    ì§€ì› í˜•ì‹: Excel (.xlsx, .xls) | ìµœëŒ€ í¬ê¸°: 10MB
                                </div>
                            </div>
                        </div>

                        <div id="previewSection" class="hidden">
                            <h3>ğŸ“Š ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h3>
                            <div id="previewTable"></div>
                            
                            <div class="flex gap-10" style="margin-top: 20px;">
                                <button class="btn" onclick="processExcelData()">
                                    âœ… ë°ì´í„° ë“±ë¡
                                </button>
                                <button class="btn btn-secondary" onclick="clearExcelData()">
                                    ğŸ”„ ë‹¤ì‹œ ì—…ë¡œë“œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì§€ì› ëª©ë¡ í˜ì´ì§€ -->
            <div id="listPage" class="container hidden">
                <h1 class="page-title">ğŸ“‹ ì§€ì› ê¸°ë¡ ëª©ë¡</h1>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ì‚¬ì´íŠ¸ëª…</th>
                                <th>ì—”ì§€ë‹ˆì–´</th>
                                <th>ì§€ì› íƒ€ì…</th>
                                <th>ì‹œì‘ì¼ì‹œ</th>
                                <th>ì¢…ë£Œì¼ì‹œ</th>
                                <th>ì´ ì‹œê°„</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTableBody">
                        </tbody>
                    </table>
                    <div id="emptyState" class="empty-state hidden">
                        ğŸ—‚ï¸ ë“±ë¡ëœ ì§€ì› ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
        'use strict';
        
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let currentPage = 'dashboard';
        let supportRecords = [];
        let filteredRecords = [];
        let editingRecord = null;
        let charts = {};
        let currentChartTab = 'monthly';
        let currentStatsTab = 'engineer';
        let currentRegisterTab = 'manual';

        // ì‚¬ìš©ì ë°ì´í„°
        const users = [
            { username: 'admin', password: 'admin123', name: 'ê´€ë¦¬ì' },
            { username: 'engineer1', password: 'eng123', name: 'ì—”ì§€ë‹ˆì–´1' }
        ];

        // ì§€ì› íƒ€ì… ìë™ ë¶„ë¥˜ ë¡œì§
        function classifySupportType(description) {
            if (!description) return 'ê¸°ìˆ ì§€ì›'; // ì„¤ëª…ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’

            const lowerDesc = description.toLowerCase();

            // 1. ì •ê¸°ì ê²€ í‚¤ì›Œë“œ
            if (lowerDesc.includes('ì ê²€') || lowerDesc.includes('ì •ê¸°')) {
                return 'ì •ê¸°ì ê²€';
            }
            // 2. ì¥ì• ì§€ì› í‚¤ì›Œë“œ
            if (lowerDesc.includes('ì¥ì• ') || lowerDesc.includes('ì‹¤íŒ¨') || lowerDesc.includes('fault') || lowerDesc.includes('down')) {
                return 'ì¥ì• ì§€ì›';
            }
            // 3. ê¸°ìˆ ì§€ì› í‚¤ì›Œë“œ (ë‚¨ì€ ëŒ€ë¶€ë¶„ì˜ ê²½ìš°)
            if (lowerDesc.includes('ê¸°ìˆ ì§€ì›') || lowerDesc.includes('ê¸°ìˆ ë¯¸íŒ…') || lowerDesc.includes('ì„¤ì¹˜') || lowerDesc.includes('êµ¬ì„±') || lowerDesc.includes('í…ŒìŠ¤íŠ¸') || lowerDesc.includes('review') || lowerDesc.includes('poc')) {
                return 'ê¸°ìˆ ì§€ì›';
            }
            
            return 'ê¸°ìˆ ì§€ì›'; // ìœ„ì˜ ì¡°ê±´ì— ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ìˆ ì§€ì›ìœ¼ë¡œ ë¶„ë¥˜
        }
        
        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');

            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userWelcome').textContent = `${user.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤`;
                showPage('dashboard');
                errorElement.classList.add('hidden');
            } else {
                errorElement.textContent = 'ì˜ëª»ëœ ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.';
                errorElement.classList.remove('hidden');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            currentUser = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // í˜ì´ì§€ ì „í™˜
        function showPage(page) {
            ['dashboardPage', 'registerPage', 'listPage'].forEach(p => {
                document.getElementById(p).classList.add('hidden');
            });

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            document.getElementById(page + 'Page').classList.remove('hidden');
            if (event && event.target) {
                event.target.classList.add('active');
            }

            currentPage = page;

            if (page === 'dashboard') {
                updateFilterOptions();
                applyFilters();
            } else if (page === 'list') {
                updateRecordsList();
            }
        }

        // ì°¨íŠ¸ íƒ­ ì „í™˜
        function showChartTab(tabName) {
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.chart-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            event.target.classList.add('active');
            document.getElementById(tabName + 'ChartContainer').classList.remove('hidden');
            
            currentChartTab = tabName;
            updateSpecificChart(tabName);
        }

        // í†µê³„ íƒ­ ì „í™˜
        function showStatsTab(tabName) {
            document.querySelectorAll('.stats-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.stats-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            event.target.classList.add('active');
            document.getElementById(tabName + 'StatsContainer').classList.remove('hidden');
            
            currentStatsTab = tabName;
            updateDetailStats();
        }

        // ë“±ë¡ íƒ­ ì „í™˜
        function showRegisterTab(tabName) {
            document.querySelectorAll('.register-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.register-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            event.target.classList.add('active');
            document.getElementById(tabName + 'RegisterContent').classList.remove('hidden');
            
            currentRegisterTab = tabName;
        }

        // í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateFilterOptions() {
            const engineers = [...new Set(supportRecords.map(r => r.engineerName))].sort();
            const sites = [...new Set(supportRecords.map(r => r.siteName))].sort();
            
            const engineerSelect = document.getElementById('filterEngineer');
            const siteSelect = document.getElementById('filterSite');

            engineerSelect.innerHTML = '<option value="">ì „ì²´ ì—”ì§€ë‹ˆì–´</option>';
            engineers.forEach(engineer => {
                engineerSelect.innerHTML += `<option value="${engineer}">${engineer}</option>`;
            });

            siteSelect.innerHTML = '<option value="">ì „ì²´ ì‚¬ì´íŠ¸</option>';
            sites.forEach(site => {
                siteSelect.innerHTML += `<option value="${site}">${site}</option>`;
            });
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const keyword = document.getElementById('searchKeyword').value.toLowerCase();
            const engineerFilter = document.getElementById('filterEngineer').value;
            const siteFilter = document.getElementById('filterSite').value;
            const supportTypeFilter = document.getElementById('filterSupportType').value;
            const startDateFilter = document.getElementById('filterStartDate').value;
            const endDateFilter = document.getElementById('filterEndDate').value;

            filteredRecords = supportRecords.filter(record => {
                if (keyword && !record.siteName.toLowerCase().includes(keyword) && 
                    !record.engineerName.toLowerCase().includes(keyword)) {
                    return false;
                }
                if (engineerFilter && record.engineerName !== engineerFilter) return false;
                if (siteFilter && record.siteName !== siteFilter) return false;
                if (supportTypeFilter && record.supportType !== supportTypeFilter) return false;
                if (startDateFilter && record.startDate < startDateFilter) return false;
                if (endDateFilter && record.startDate > endDateFilter) return false;
                return true;
            });

            updateDashboard();
        }

        // í•„í„° ì´ˆê¸°í™”
        function clearFilters() {
            ['searchKeyword', 'filterEngineer', 'filterSite', 'filterSupportType', 'filterStartDate', 'filterEndDate'].forEach(id => {
                document.getElementById(id).value = '';
            });
            applyFilters();
        }

        // ì‹œê°„ ê³„ì‚°
        function calculateSupportHours(startDate, startTime, endDate, endTime) {
            if (!startDate || !startTime || !endDate || !endTime) return 0;
            
            const start = new Date(`${startDate}T${startTime}`);
            const end = new Date(`${endDate}T${endTime}`);
            const diffInMs = end - start;
            const diffInHours = diffInMs / (1000 * 60 * 60);
            
            return Math.max(0, diffInHours);
        }

        // ì‹¤ì‹œê°„ ì‹œê°„ ê³„ì‚° ì—…ë°ì´íŠ¸
        function updateCalculatedHours() {
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value;
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value;

            const hours = calculateSupportHours(startDate, startTime, endDate, endTime);
            document.getElementById('calculatedHours').textContent = hours.toFixed(1);
        }

        // ì§€ì› ê¸°ë¡ ì œì¶œ
        function handleSubmitSupport() {
            const siteName = document.getElementById('siteName').value;
            const engineerName = document.getElementById('engineerName').value;
            const supportType = document.getElementById('supportType').value;
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value;
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value;

            if (!siteName || !engineerName || !supportType || !startDate || !startTime || !endDate || !endTime) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const totalHours = calculateSupportHours(startDate, startTime, endDate, endTime);

            const record = {
                id: editingRecord ? editingRecord.id : Date.now(),
                siteName,
                engineerName,
                supportType,
                startDate,
                startTime,
                endDate,
                endTime,
                totalHours: totalHours.toFixed(1),
                createdAt: editingRecord ? editingRecord.createdAt : new Date().toISOString()
            };

            if (editingRecord) {
                const index = supportRecords.findIndex(r => r.id === record.id);
                supportRecords[index] = record;
            } else {
                supportRecords.push(record);
            }

            clearForm();
            alert(editingRecord ? 'ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ê¸°ë¡ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            showPage('list');
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            ['siteName', 'engineerName', 'supportType', 'startDate', 'startTime', 'endDate', 'endTime'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('calculatedHours').textContent = '0';
            
            editingRecord = null;
            document.getElementById('registerTitle').textContent = 'â• ì‚¬ì´íŠ¸ ì§€ì› ë“±ë¡';
            document.getElementById('submitBtn').textContent = 'ë“±ë¡';
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        // ê¸°ë¡ í¸ì§‘
        function editRecord(id) {
            const record = supportRecords.find(r => r.id === id);
            if (!record) return;

            editingRecord = record;
            ['siteName', 'engineerName', 'supportType', 'startDate', 'startTime', 'endDate', 'endTime'].forEach(field => {
                document.getElementById(field).value = record[field];
            });
            
            updateCalculatedHours();
            
            document.getElementById('registerTitle').textContent = 'âœï¸ ì§€ì› ê¸°ë¡ ìˆ˜ì •';
            document.getElementById('submitBtn').textContent = 'ìˆ˜ì •';
            document.getElementById('cancelBtn').classList.remove('hidden');
            
            showPage('register');
        }

        // í¸ì§‘ ì·¨ì†Œ
        function handleCancelEdit() {
            clearForm();
        }

        // ê¸°ë¡ ì‚­ì œ
        function deleteRecord(id) {
            if (confirm('ì •ë§ë¡œ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                supportRecords = supportRecords.filter(r => r.id !== id);
                updateRecordsList();
                if (currentPage === 'dashboard') {
                    applyFilters();
                }
                alert('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê¸°ë¡ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateRecordsList() {
            const tbody = document.getElementById('recordsTableBody');
            const emptyState = document.getElementById('emptyState');

            if (supportRecords.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            tbody.innerHTML = supportRecords.map(record => `
                <tr>
                    <td>${record.siteName}</td>
                    <td>${record.engineerName}</td>
                    <td><span class="support-type-badge ${record.supportType}">${record.supportType}</span></td>
                    <td>${record.startDate} ${record.startTime}</td>
                    <td>${record.endDate} ${record.endTime}</td>
                    <td>${record.totalHours}h</td>
                    <td>
                        <button class="action-btn" onclick="editRecord(${record.id})" title="ìˆ˜ì •">âœï¸</button>
                        <button class="action-btn delete" onclick="deleteRecord(${record.id})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            updateStats();
            updateCharts();
            updateDetailStats();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const records = filteredRecords;
            const totalRecords = records.length;
            const totalHours = records.reduce((sum, record) => sum + parseFloat(record.totalHours), 0);
            const avgHours = totalRecords > 0 ? totalHours / totalRecords : 0;
            const activeEngineers = [...new Set(records.map(r => r.engineerName))].length;

            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('totalHours').textContent = totalHours.toFixed(1) + 'h';
            document.getElementById('avgHours').textContent = avgHours.toFixed(1) + 'h';
            document.getElementById('activeEngineers').textContent = activeEngineers;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            updateSpecificChart(currentChartTab);
        }

        // íŠ¹ì • ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateSpecificChart(chartType) {
            switch(chartType) {
                case 'monthly': updateMonthlyChart(); break;
                case 'engineer': updateEngineerChart(); break;
                case 'supporttype': updateSupportTypeChart(); break;
                case 'site': updateSiteChart(); break;
            }
        }

        // ì›”ê°„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateMonthlyChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            if (charts.monthly) charts.monthly.destroy();

            const monthlyData = {};
            filteredRecords.forEach(record => {
                const month = record.startDate.slice(0, 7);
                if (!monthlyData[month]) monthlyData[month] = {};
                if (!monthlyData[month][record.siteName]) monthlyData[month][record.siteName] = 0;
                monthlyData[month][record.siteName] += parseFloat(record.totalHours);
            });

            const months = Object.keys(monthlyData).sort();
            const sites = [...new Set(filteredRecords.map(r => r.siteName))];
            
            const datasets = sites.map((site, index) => ({
                label: site,
                data: months.map(month => monthlyData[month][site] || 0),
                backgroundColor: `hsl(${index * 60}, 70%, 60%)`,
                borderColor: `hsl(${index * 60}, 70%, 50%)`,
                borderWidth: 2,
                borderRadius: 5
            }));

            charts.monthly = new Chart(ctx, {
                type: 'bar',
                data: { labels: months, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'ì›”ê°„ ì‚¬ì´íŠ¸ë³„ ì§€ì› ì‹œê°„' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'ì§€ì› ì‹œê°„ (h)' } },
                        x: { title: { display: true, text: 'ì›”' } }
                    }
                }
            });
        }

        // ì—”ì§€ë‹ˆì–´ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateEngineerChart() {
            const ctx = document.getElementById('engineerChart').getContext('2d');
            
            if (charts.engineer) charts.engineer.destroy();

            const engineerData = {};
            filteredRecords.forEach(record => {
                if (!engineerData[record.engineerName]) {
                    engineerData[record.engineerName] = { hours: 0, count: 0 };
                }
                engineerData[record.engineerName].hours += parseFloat(record.totalHours);
                engineerData[record.engineerName].count++;
            });

            const engineers = Object.keys(engineerData);
            const totalHours = engineers.map(eng => engineerData[eng].hours.toFixed(1));
            const avgHours = engineers.map(eng => (engineerData[eng].hours / engineerData[eng].count).toFixed(1));

            charts.engineer = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: engineers,
                    datasets: [
                        {
                            label: 'ì´ ì§€ì› ì‹œê°„',
                            data: totalHours,
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'ì—”ì§€ë‹ˆì–´ë³„ ì§€ì› í†µê³„' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'ì‹œê°„ (h)' } }
                    }
                }
            });
        }

        // ì§€ì› íƒ€ì…ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateSupportTypeChart() {
            const ctx = document.getElementById('supportTypeChart').getContext('2d');
            
            if (charts.supporttype) charts.supporttype.destroy();

            const typeData = {};
            filteredRecords.forEach(record => {
                if (!typeData[record.supportType]) typeData[record.supportType] = 0;
                typeData[record.supportType] += parseFloat(record.totalHours);
            });

            const types = Object.keys(typeData);
            const hours = Object.values(typeData);
            const colors = ['#28a745', '#007bff', '#dc3545'];

            charts.supporttype = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: types,
                    datasets: [{
                        data: hours,
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: { display: true, text: 'ì§€ì› íƒ€ì…ë³„ ì‹œê°„ ë¶„í¬' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toFixed(1)}h (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì‚¬ì´íŠ¸ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateSiteChart() {
            const ctx = document.getElementById('siteChart').getContext('2d');
            
            if (charts.site) charts.site.destroy();

            const siteData = {};
            filteredRecords.forEach(record => {
                if (!siteData[record.siteName]) siteData[record.siteName] = 0;
                siteData[record.siteName] += parseFloat(record.totalHours);
            });

            const sites = Object.keys(siteData);
            const hours = Object.values(siteData);
            const colors = sites.map((_, index) => `hsl(${index * 60}, 70%, 60%)`);

            charts.site = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: sites,
                    datasets: [{
                        data: hours,
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: { display: true, text: 'ì‚¬ì´íŠ¸ë³„ ì´ ì§€ì› ì‹œê°„ ë¶„í¬' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toFixed(1)}h (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ìƒì„¸ í†µê³„ ì—…ë°ì´íŠ¸
        function updateDetailStats() {
            switch(currentStatsTab) {
                case 'engineer': updateEngineerStats(); break;
                case 'site': updateSiteStats(); break;
                case 'supporttype': updateSupportTypeStats(); break;
            }
        }

        // ì—”ì§€ë‹ˆì–´ë³„ ìƒì„¸ í†µê³„
        function updateEngineerStats() {
            const tbody = document.getElementById('engineerStatsBody');
            const records = filteredRecords;

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #6c757d;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            const engineerStats = {};
            records.forEach(record => {
                const engineer = record.engineerName;
                if (!engineerStats[engineer]) {
                    engineerStats[engineer] = {
                        count: 0, totalHours: 0, ì •ê¸°ì ê²€: 0, ê¸°ìˆ ì§€ì›: 0, ì¥ì• ì§€ì›: 0
                    };
                }
                engineerStats[engineer].count++;
                engineerStats[engineer].totalHours += parseFloat(record.totalHours);
                engineerStats[engineer][record.supportType]++;
            });

            tbody.innerHTML = Object.keys(engineerStats).map(engineer => {
                const stat = engineerStats[engineer];
                const avgHours = stat.totalHours / stat.count;
                return `
                    <tr>
                        <td style="font-weight: 600; color: #667eea;">${engineer}</td>
                        <td>${stat.count}</td>
                        <td>${stat.totalHours.toFixed(1)}h</td>
                        <td>${avgHours.toFixed(1)}h</td>
                        <td>${stat.ì •ê¸°ì ê²€}</td>
                        <td>${stat.ê¸°ìˆ ì§€ì›}</td>
                        <td>${stat.ì¥ì• ì§€ì›}</td>
                    </tr>
                `;
            }).join('');
        }

        // ì‚¬ì´íŠ¸ë³„ ìƒì„¸ í†µê³„
        function updateSiteStats() {
            const tbody = document.getElementById('siteStatsBody');
            const records = filteredRecords;

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            const siteStats = {};
            records.forEach(record => {
                const site = record.siteName;
                if (!siteStats[site]) {
                    siteStats[site] = {
                        count: 0, totalHours: 0, engineers: new Set(), supportTypes: {}
                    };
                }
                siteStats[site].count++;
                siteStats[site].totalHours += parseFloat(record.totalHours);
                siteStats[site].engineers.add(record.engineerName);
                if (!siteStats[site].supportTypes[record.supportType]) {
                    siteStats[site].supportTypes[record.supportType] = 0;
                }
                siteStats[site].supportTypes[record.supportType]++;
            });

            tbody.innerHTML = Object.keys(siteStats).map(site => {
                const stat = siteStats[site];
                const avgHours = stat.totalHours / stat.count;
                const mainType = Object.keys(stat.supportTypes).reduce((a, b) => 
                    stat.supportTypes[a] > stat.supportTypes[b] ? a : b);
                return `
                    <tr>
                        <td style="font-weight: 600; color: #667eea;">${site}</td>
                        <td>${stat.count}</td>
                        <td>${stat.totalHours.toFixed(1)}h</td>
                        <td>${avgHours.toFixed(1)}h</td>
                        <td>${stat.engineers.size}ëª…</td>
                        <td><span class="support-type-badge ${mainType}">${mainType}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // ì§€ì› íƒ€ì…ë³„ ìƒì„¸ í†µê³„
        function updateSupportTypeStats() {
            const tbody = document.getElementById('supportTypeStatsBody');
            const records = filteredRecords;

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            const typeStats = {};
            records.forEach(record => {
                const type = record.supportType;
                if (!typeStats[type]) {
                    typeStats[type] = { count: 0, totalHours: 0, engineers: new Set() };
                }
                typeStats[type].count++;
                typeStats[type].totalHours += parseFloat(record.totalHours);
                typeStats[type].engineers.add(record.engineerName);
            });

            const totalRecords = records.length;
            tbody.innerHTML = Object.keys(typeStats).map(type => {
                const stat = typeStats[type];
                const avgHours = stat.totalHours / stat.count;
                const percentage = ((stat.count / totalRecords) * 100).toFixed(1);
                return `
                    <tr>
                        <td><span class="support-type-badge ${type}">${type}</span></td>
                        <td>${stat.count}</td>
                        <td>${stat.totalHours.toFixed(1)}h</td>
                        <td>${avgHours.toFixed(1)}h</td>
                        <td>${stat.engineers.size}ëª…</td>
                        <td>${percentage}%</td>
                    </tr>
                `;
            }).join('');
        }

        // ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadExcelTemplate() {
            const templateData = [
                ['ì‚¬ì´íŠ¸ëª…', 'ì—”ì§€ë‹ˆì–´ëª…', 'ì‹œì‘ë‚ ì§œ', 'ì‹œì‘ì‹œê°„', 'ì¢…ë£Œë‚ ì§œ', 'ì¢…ë£Œì‹œê°„', 'ì§€ì› íƒ€ì…', 'ì„¤ëª… (ì„ íƒ)'],
                ['Arctera', '[ì‹œì˜¤ë©] ê¸°ìˆ ì§€ì›ë³¸ë¶€ ì„ëª…ì—´', '2025-01-07', '09:30', '2025-01-07', '17:30', 'ì •ê¸°ì ê²€', 'ì •ê¸°ì ê²€ íšŒì˜'],
                ['ëŒ€ë¦¼ê·¸ë£¹', '[ì‹œì˜¤ë©] ì—”ì§€ë‹ˆì–´íŒ€ ì†ìš©ë½', '2025-01-08', '08:00', '2025-01-08', '16:00', 'ê¸°ìˆ ì§€ì›', 'í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜ ê¸°ìˆ  ì§€ì›'],
                ['KBêµ­ë¯¼ì€í–‰', '[ì‹œì˜¤ë©] ì—”ì§€ë‹ˆì–´íŒ€ ì—„ì •í˜„', '2025-01-09', '10:00', '2025-01-09', '18:00', 'ì¥ì• ì§€ì›', 'ë°±ì—… ì‹¤íŒ¨ë¡œ ì¸í•œ ì¥ì• ì§€ì›']
            ];

            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ì§€ì›ê¸°ë¡í…œí”Œë¦¿");
            
            ws['!cols'] = [
                {wch: 20}, {wch: 25}, {wch: 12}, {wch: 10}, {wch: 12}, {wch: 10}, {wch: 12}, {wch: 30}
            ];
            
            XLSX.writeFile(wb, "ì‚¬ì´íŠ¸ì§€ì›ê¸°ë¡_í…œí”Œë¦¿_2025.xlsx");
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
                return;
            }
            
            // íŒŒì¼ í™•ì¥ì í™•ì¸ ë° ì ì ˆí•œ íŒŒì‹± í•¨ìˆ˜ í˜¸ì¶œ
            const fileName = file.name.toLowerCase();
            const fileExtension = fileName.split('.').pop();

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    let parsedData;
                    
                    if (fileExtension === 'csv') {
                        // CSV íŒŒì¼ ì²˜ë¦¬ (Outlook í˜•ì‹ ì˜ˆìƒ)
                        parsedData = parseOutlookCsvData(data);
                    } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                        // ê¸°ì¡´ Excel íŒŒì¼ ì²˜ë¦¬
                        const workbook = XLSX.read(new Uint8Array(data), {type: 'array'});
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                        parsedData = parseGenericExcelData(jsonData);
                    } else {
                        alert('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. .xlsx, .xls, .csv íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.');
                        return;
                    }

                    if (parsedData.length === 0) {
                        alert('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    displayPreview(parsedData);

                } catch (error) {
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            
            if (fileExtension === 'csv') {
                // CSVëŠ” í…ìŠ¤íŠ¸ë¡œ ì½ìŒ
                reader.readAsText(file);
            } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                // Excelì€ ArrayBufferë¡œ ì½ìŒ
                reader.readAsArrayBuffer(file);
            }
        }
        
        // CSV ë°ì´í„° íŒŒì‹± (Outlook í˜•ì‹)
        function parseOutlookCsvData(csvString) {
            // CSV íŒŒì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ ê°„ë‹¨í•œ íŒŒì‹± (ì‰¼í‘œë¡œ ë¶„ë¦¬)
            const rows = csvString.trim().split('\n');
            if (rows.length < 2) return [];

            const headers = rows[0].trim().split(',').map(h => h.replace(/"/g, '').trim());
            const dataRows = rows.slice(1);

            // í•„ìš”í•œ ì—´ ì¸ë±ìŠ¤ ì°¾ê¸°
            const indices = {
                title: headers.indexOf('ì œëª©'),
                organizer: headers.indexOf('ëª¨ì„ ì´ëŒì´'),
                startDate: headers.indexOf('ì‹œì‘ ë‚ ì§œ'),
                startTime: headers.indexOf('ì‹œì‘ ì‹œê°„'),
                endDate: headers.indexOf('ë ë‚ ì§œ'),
                endTime: headers.indexOf('ë ì‹œê°„'),
                description: headers.indexOf('ì„¤ëª…')
            };

            const requiredIndices = ['title', 'organizer', 'startDate', 'startTime', 'endDate', 'endTime'];
            if (requiredIndices.some(key => indices[key] === -1)) {
                 alert("CSV íŒŒì¼ì—ì„œ 'ì œëª©', 'ëª¨ì„ ì´ëŒì´', 'ì‹œì‘ ë‚ ì§œ', 'ì‹œì‘ ì‹œê°„', 'ë ë‚ ì§œ', 'ë ì‹œê°„' ì—´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Outlook ì¼ì • CSV í˜•ì‹ì´ ë§ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
                 return [];
            }


            const validData = [];
            dataRows.forEach(row => {
                // ë”°ì˜´í‘œì™€ ì‰¼í‘œ ì²˜ë¦¬ê°€ ë³µì¡í•˜ë¯€ë¡œ ê°„ë‹¨íˆ ì‰¼í‘œë¡œ ë¶„ë¦¬ (ì •í™•ë„ë¥¼ ìœ„í•´ì„  íŒŒì„œ í•„ìš”)
                // í˜„ì¬ CSVëŠ” ê° í•„ë“œê°€ í°ë”°ì˜´í‘œë¡œ ë¬¶ì—¬ìˆê³ , í•„ë“œ ë‚´ ì¤„ë°”ê¿ˆì´ ìˆì–´ ì •ê·œì‹ìœ¼ë¡œ ì²˜ë¦¬
                // rows.slice(1)ì˜ ë°ì´í„°ë§Œ ì‚¬ìš©.
                
                // ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì—¬ í°ë”°ì˜´í‘œë¡œ ë¬¶ì¸ í•„ë“œì™€ ê·¸ë ‡ì§€ ì•Šì€ í•„ë“œë¥¼ ë¶„ë¦¬
                const fields = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || row.split(',');
                if (fields.length < headers.length) {
                    // í•„ë“œ ìˆ˜ê°€ ë¶€ì¡±í•˜ë©´ ê±´ë„ˆëœ€ (ì·¨ì†Œëœ ì¼ì • ë“±)
                    if(row.includes('ì·¨ì†Œë¨')) return; 
                }
                
                // í•„ë“œì—ì„œ í°ë”°ì˜´í‘œ ì œê±° ë° ì•ë’¤ ê³µë°± ì œê±°
                const cleanFields = fields.map(field => field.replace(/^"|"$/g, '').trim());


                const siteName = cleanFields[indices.title];
                let engineerName = cleanFields[indices.organizer];
                const startDate = cleanFields[indices.startDate];
                const startTimeRaw = cleanFields[indices.startTime];
                const endDate = cleanFields[indices.endDate];
                const endTimeRaw = cleanFields[indices.endTime];
                const description = cleanFields[indices.description];

                // ì—”ì§€ë‹ˆì–´ ì´ë¦„ì—ì„œ ì¡°ì§ ì •ë³´ ì œê±° (ì˜ˆ: [ì‹œì˜¤ë©] SCíŒ€ ê¹€ì¤€ê·œ -> ê¹€ì¤€ê·œ)
                if(engineerName) {
                    engineerName = engineerName.replace(/\[[^\]]+\]\s*/g, '').trim();
                } else {
                    engineerName = "ë¯¸ì •";
                }

                // ì‹œê°„ ë¬¸ìì—´ ì •ë¦¬ (ì˜ˆ: "ì˜¤ì „ 9:00:00" -> "09:00")
                const formatTime = (timeStr) => {
                    if (!timeStr) return '';
                    // 'ì˜¤ì „' ë˜ëŠ” 'ì˜¤í›„' ë° ì´ˆ ì œê±°. ì •ê·œì‹ìœ¼ë¡œ ì²˜ë¦¬.
                    let time = timeStr.replace(/.*?(\d+:\d+)(:\d+)?$/, '$1').trim();
                    if(time.length === 4) time = '0' + time; // '9:00' -> '09:00'
                    return time;
                };

                const startTime = formatTime(startTimeRaw);
                const endTime = formatTime(endTimeRaw);
                
                const supportType = classifySupportType(siteName + ' ' + description);
                const totalHours = calculateSupportHours(startDate, startTime, endDate, endTime);

                // ìœ íš¨ì„± ê²€ì‚¬ (ì´ ì‹œê°„ì´ 0ì´ ì•„ë‹ˆê³  í•„ìˆ˜ í•„ë“œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°)
                if (siteName && engineerName && startDate && endDate && totalHours > 0) {
                     validData.push({
                        siteName: siteName.replace(/^ì·¨ì†Œë¨: /g, '').trim(), // ì œëª©ì— ì·¨ì†Œë¨ì´ ìˆë‹¤ë©´ ì œê±°
                        engineerName: engineerName,
                        supportType: supportType,
                        startDate,
                        startTime,
                        endDate,
                        endTime,
                        totalHours: totalHours.toFixed(1)
                    });
                }
            });

            return validData;
        }

        // ì¼ë°˜ ì—‘ì…€ ë°ì´í„° íŒŒì‹± (ê¸°ì¡´ í…œí”Œë¦¿ í˜•ì‹)
        function parseGenericExcelData(jsonData) {
            if (jsonData.length < 2) return [];

            const headers = jsonData[0];
            const dataRows = jsonData.slice(1);
            
            const validData = [];
            dataRows.forEach(row => {
                if (row.length >= 7 && row[0] && row[1] && row[6]) {
                    const startDate = formatDateFromExcel(row[2]);
                    const startTime = formatTimeFromExcel(row[3]);
                    const endDate = formatDateFromExcel(row[4]);
                    const endTime = formatTimeFromExcel(row[5]);
                    
                    if (startDate && startTime && endDate && endTime) {
                        const totalHours = calculateSupportHours(startDate, startTime, endDate, endTime);
                        if(totalHours > 0) {
                            validData.push({
                                siteName: row[0].toString().trim(),
                                engineerName: row[1].toString().trim(),
                                supportType: row[6].toString().trim(),
                                startDate,
                                startTime,
                                endDate,
                                endTime,
                                totalHours: totalHours.toFixed(1)
                            });
                        }
                    }
                }
            });

            return validData;
        }

        // ì—‘ì…€ ë‚ ì§œ í˜•ì‹ ë³€í™˜
        function formatDateFromExcel(value) {
            if (!value) return '';
            
            if (typeof value === 'number') {
                const date = XLSX.SSF.parse_date_code(value);
                return `${date.y}-${String(date.m).padStart(2, '0')}-${String(date.d).padStart(2, '0')}`;
            }
            
            const dateStr = value.toString().trim();
            if (dateStr.includes('T')) {
                return dateStr.split('T')[0];
            }
            // YYYY-MM-DD í˜•ì‹ì´ ì´ë¯¸ ê°–ì¶°ì§„ ê²½ìš°
            if (/^\d{4}-\d{1,2}-\d{1,2}$/.test(dateStr)) {
                return dateStr;
            }
            
            return dateStr;
        }

        // ì—‘ì…€ ì‹œê°„ í˜•ì‹ ë³€í™˜
        function formatTimeFromExcel(value) {
            if (!value) return '';
            
            if (typeof value === 'number') {
                const totalMinutes = Math.round(value * 24 * 60);
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            }
            
            const timeStr = value.toString().trim();
            if (timeStr.includes('T')) {
                return timeStr.split('T')[1].substring(0, 5);
            }
            // HH:MM í˜•ì‹ì´ ì´ë¯¸ ê°–ì¶°ì§„ ê²½ìš°
            if (/^\d{1,2}:\d{1,2}(:\d{2})?$/.test(timeStr)) {
                return timeStr.substring(0, 5);
            }
            
            return timeStr;
        }

        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function displayPreview(data) {
            const previewSection = document.getElementById('previewSection');
            const previewTable = document.getElementById('previewTable');
            
            let tableHTML = `
                <div style="max-height: 400px; overflow: auto; border: 1px solid #e5e7eb; border-radius: 10px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 12px;">ì‚¬ì´íŠ¸ëª…</th>
                                <th style="padding: 12px;">ì—”ì§€ë‹ˆì–´ëª…</th>
                                <th style="padding: 12px;">ì§€ì› íƒ€ì…</th>
                                <th style="padding: 12px;">ì‹œì‘ì¼ì‹œ</th>
                                <th style="padding: 12px;">ì¢…ë£Œì¼ì‹œ</th>
                                <th style="padding: 12px;">ì´ ì‹œê°„</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            data.forEach((record, index) => {
                tableHTML += `
                    <tr style="border-bottom: 1px solid #e5e7eb; ${index % 2 === 0 ? 'background: #f9fafb;' : ''}">
                        <td style="padding: 10px;">${record.siteName}</td>
                        <td style="padding: 10px;">${record.engineerName}</td>
                        <td style="padding: 10px;"><span class="support-type-badge ${record.supportType}">${record.supportType}</span></td>
                        <td style="padding: 10px;">${record.startDate} ${record.startTime}</td>
                        <td style="padding: 10px;">${record.endDate} ${record.endTime}</td>
                        <td style="padding: 10px;">${record.totalHours}h</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table></div>';
            previewTable.innerHTML = tableHTML;
            previewSection.classList.remove('hidden');
            
            window.previewData = data;
        }

        // ì—‘ì…€ ë°ì´í„° ì²˜ë¦¬
        function processExcelData() {
            if (!window.previewData || window.previewData.length === 0) {
                alert('ì²˜ë¦¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!confirm(`ì´ ${window.previewData.length}ê°œì˜ ê¸°ë¡ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì·¨ì†Œëœ ì¼ì • ì œì™¸)`)) {
                return;
            }

            window.previewData.forEach(record => {
                supportRecords.push({
                    id: Date.now() + Math.random(),
                    ...record,
                    createdAt: new Date().toISOString()
                });
            });
            saveRecordsToLocalStorage();

            alert(`${window.previewData.length}ê°œì˜ ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            clearExcelData();
            showPage('list');
        }

        // ì—‘ì…€ ë°ì´í„° ì´ˆê¸°í™”
        function clearExcelData() {
            document.getElementById('excelFileInput').value = '';
            document.getElementById('previewSection').classList.add('hidden');
            window.previewData = null;
        }

        // JSON ë°ì´í„° ì €ì¥
        function saveDataToJSON() {
            if (supportRecords.length === 0) {
                showDataStatus('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                return;
            }

            const dataToSave = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                exportedBy: currentUser ? currentUser.name : 'Unknown',
                totalRecords: supportRecords.length,
                data: supportRecords
            };

            const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `site_support_data_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showDataStatus(`âœ… ì´ ${supportRecords.length}ê°œ ê¸°ë¡ì´ JSON íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // JSON ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadDataFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    if (!jsonData.data || !Array.isArray(jsonData.data)) {
                        throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ JSON íŒŒì¼ êµ¬ì¡°ì…ë‹ˆë‹¤.');
                    }

                    if (!confirm(`í˜„ì¬ ë°ì´í„°: ${supportRecords.length}ê°œ\në¶ˆëŸ¬ì˜¬ ë°ì´í„°: ${jsonData.data.length}ê°œ\n\nê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ëŒ€ì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        return;
                    }

                    supportRecords = jsonData.data;
                    filteredRecords = supportRecords.slice();

                    updateFilterOptions();
                    applyFilters();
                    updateRecordsList();

                    showDataStatus(`âœ… ${supportRecords.length}ê°œì˜ ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤.`, 'success');

                    if (currentPage !== 'dashboard') {
                        showPage('dashboard');
                    }

                } catch (error) {
                    showDataStatus('âŒ JSON íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };

            reader.readAsText(file);
            event.target.value = '';
        }

        // ë°ì´í„° ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showDataStatus(message, type) {
            const statusElement = document.getElementById('dataStatus');
            statusElement.textContent = message;
            statusElement.className = `data-status ${type}`;
            statusElement.classList.remove('hidden');

            setTimeout(() => {
                statusElement.classList.add('hidden');
            }, 5000);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            // ì—”í„°í‚¤ ë¡œê·¸ì¸
            ['username', 'password'].forEach(id => {
                document.getElementById(id).addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') handleLogin();
                });
            });

            // ì‹¤ì‹œê°„ ì‹œê°„ ê³„ì‚°
            ['startDate', 'startTime', 'endDate', 'endTime'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateCalculatedHours);
            });

            // ê²€ìƒ‰ ì‹¤ì‹œê°„ ì ìš©
            document.getElementById('searchKeyword').addEventListener('input', function() {
                clearTimeout(this.searchTimeout);
                this.searchTimeout = setTimeout(() => applyFilters(), 300);
            });
            // **[ìˆ˜ì • ì‹œì‘]** 1. ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            loadRecordsFromLocalStorage(); 
            // **[ìˆ˜ì • ì¢…ë£Œ]**

            // ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ì‹¤ì œ ì—‘ì…€ ë°ì´í„° ê¸°ë°˜)
            setTimeout(() => {
                if (supportRecords.length === 0) {
                    generateSampleData();
                }
            }, 1000);
        });

        // **[ìƒˆë¡œìš´ í•¨ìˆ˜]** ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function loadRecordsFromLocalStorage() {
              const savedData = localStorage.getItem('supportRecords');
              if (savedData) {
                  try {
                        supportRecords = JSON.parse(savedData);
                        // ìˆ«ì í˜•ì‹ìœ¼ë¡œ ë³€í™˜ì´ í•„ìš”í•œ ê²½ìš° ë‹¤ì‹œ ë³€í™˜
                        supportRecords.forEach(r => {
                            r.totalHours = parseFloat(r.totalHours);
                            // IDê°€ ë¬¸ìì—´ì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ìˆ«ìë¡œ ë‹¤ì‹œ ë³€í™˜
                            r.id = parseInt(r.id); 
                      });
                      filteredRecords = supportRecords.slice();
                      console.log(`âœ… ${supportRecords.length}ê°œì˜ ê¸°ë¡ì„ ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
                } catch (e) {
                    console.error("ë¡œì»¬ ì €ì¥ì†Œ ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
                }
            }
        }

        // ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ì‹¤ì œ ì—‘ì…€ ë°ì´í„° ê¸°ë°˜)
        function generateSampleData() {
            const sampleRecords = [
                { id: 1, siteName: 'Arctera', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-07', startTime: '09:30', endDate: '2025-01-07', endTime: '17:30', totalHours: '8.0', createdAt: '2025-01-07T09:30:00.000Z' },
                { id: 2, siteName: 'ëŒ€ë¦¼ê·¸ë£¹', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '09:30', endDate: '2025-01-06', endTime: '14:30', totalHours: '5.0', createdAt: '2025-01-06T09:30:00.000Z' },
                { id: 3, siteName: 'ì¸ì¬INC', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-09', startTime: '10:00', endDate: '2025-01-10', endTime: '12:00', totalHours: '26.0', createdAt: '2025-01-09T09:30:00.000Z' },
                { id: 4, siteName: 'ì¼€ì´ë±…í¬', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '12:00', endDate: '2025-01-07', endTime: '12:00', totalHours: '24.0', createdAt: '2025-01-06T07:30:00.000Z' },
                { id: 5, siteName: 'ëŒ€ë¦¼ê·¸ë£¹', engineerName: 'ì†ìš©ë½', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-07', startTime: '10:00', endDate: '2025-01-07', endTime: '13:30', totalHours: '3.5', createdAt: '2025-01-06T09:30:00.000Z' },
                { id: 6, siteName: 'KBêµ­ë¯¼ì€í–‰', engineerName: 'ì—„ì •í˜„', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-07', startTime: '10:00', endDate: '2025-01-07', endTime: '17:30', totalHours: '7.5', createdAt: '2025-01-06T09:30:00.000Z' },
                { id: 7, siteName: 'ëŒ€ë¦¼ê·¸ë£¹', engineerName: 'ì´ê²½ì§„', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '15:30', endDate: '2025-01-06', endTime: '16:30', totalHours: '1.0', createdAt: '2025-01-05T15:02:00.000Z' },
                { id: 8, siteName: 'KT êµ­ì œì „í™”íŠ¸ë˜í”½ë¶„ì„ì‹œìŠ¤í…œ', engineerName: 'ì—„ì •í˜„', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '14:00', endDate: '2025-01-06', endTime: '16:30', totalHours: '2.5', createdAt: '2025-01-05T13:32:00.000Z' },
                { id: 9, siteName: 'ì„œìš¸ì‹ ìš©ë³´ì¦ì¬ë‹¨', engineerName: 'ì†ìš©ë½', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-07', startTime: '14:00', endDate: '2025-01-07', endTime: '15:00', totalHours: '1.0', createdAt: '2025-01-06T13:32:00.000Z' },
                { id: 10, siteName: 'KT Bizì†”ë£¨ì…˜í”Œë«í¼ìš´ìš©íŒ€', engineerName: 'ì—„ì •í˜„', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-08', startTime: '10:00', endDate: '2025-01-08', endTime: '11:00', totalHours: '1.0', createdAt: '2025-01-07T09:30:00.000Z' },
                { id: 11, siteName: 'GTX-A ë¯¼ìêµ¬ê°„', engineerName: 'ì†ìš©ë½', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-09', startTime: '09:00', endDate: '2025-01-09', endTime: '14:00', totalHours: '5.0', createdAt: '2025-01-08T08:30:00.000Z' },
                { id: 12, siteName: 'ë¡¯ë°ì¹´ë“œ', engineerName: 'ê¹€ì¤€ê·œ', supportType: 'ì¥ì• ì§€ì›', startDate: '2025-01-10', startTime: '14:30', endDate: '2025-01-10', endTime: '17:30', totalHours: '3.0', createdAt: '2025-01-14T13:32:00.000Z' },
                { id: 13, siteName: 'KT Tving', engineerName: 'ì—„ì •í˜„', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-09', startTime: '14:00', endDate: '2025-01-09', endTime: '15:30', totalHours: '1.5', createdAt: '2025-01-08T13:32:00.000Z' },
                { id: 14, siteName: 'KT CLOUD IPC', engineerName: 'ì—„ì •í˜„', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-08', startTime: '14:00', endDate: '2025-01-08', endTime: '17:30', totalHours: '3.5', createdAt: '2025-01-07T13:32:00.000Z' },
                { id: 15, siteName: 'Arctera', engineerName: 'ë¯¸ì •', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-20', startTime: '14:00', endDate: '2025-01-20', endTime: '23:30', totalHours: '9.5', createdAt: '2025-01-19T13:32:00.000Z' }
            ];
            
            supportRecords = sampleRecords;
            filteredRecords = supportRecords.slice();
            
            if (currentPage === 'dashboard') {
                updateFilterOptions();
                applyFilters();
            }
            updateRecordsList();
        }
    </script><script>
        'use strict';
        
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let currentPage = 'dashboard';
        let supportRecords = [];
        let filteredRecords = [];
        let editingRecord = null;
        let charts = {};
        let currentChartTab = 'monthly';
        let currentStatsTab = 'engineer';
        let currentRegisterTab = 'manual';

        // ì‚¬ìš©ì ë°ì´í„°
        const users = [
            { username: 'admin', password: 'admin123', name: 'ê´€ë¦¬ì' },
            { username: 'engineer1', password: 'eng123', name: 'ì—”ì§€ë‹ˆì–´1' }
        ];

        // ì§€ì› íƒ€ì… ìë™ ë¶„ë¥˜ ë¡œì§
        function classifySupportType(description) {
            if (!description) return 'ê¸°ìˆ ì§€ì›'; // ì„¤ëª…ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’

            const lowerDesc = description.toLowerCase();

            // 1. ì •ê¸°ì ê²€ í‚¤ì›Œë“œ
            if (lowerDesc.includes('ì ê²€') || lowerDesc.includes('ì •ê¸°')) {
                return 'ì •ê¸°ì ê²€';
            }
            // 2. ì¥ì• ì§€ì› í‚¤ì›Œë“œ
            if (lowerDesc.includes('ì¥ì• ') || lowerDesc.includes('ì‹¤íŒ¨') || lowerDesc.includes('fault') || lowerDesc.includes('down')) {
                return 'ì¥ì• ì§€ì›';
            }
            // 3. ê¸°ìˆ ì§€ì› í‚¤ì›Œë“œ (ë‚¨ì€ ëŒ€ë¶€ë¶„ì˜ ê²½ìš°)
            if (lowerDesc.includes('ê¸°ìˆ ì§€ì›') || lowerDesc.includes('ê¸°ìˆ ë¯¸íŒ…') || lowerDesc.includes('ì„¤ì¹˜') || lowerDesc.includes('êµ¬ì„±') || lowerDesc.includes('í…ŒìŠ¤íŠ¸') || lowerDesc.includes('review') || lowerDesc.includes('poc')) {
                return 'ê¸°ìˆ ì§€ì›';
            }
            
            return 'ê¸°ìˆ ì§€ì›'; // ìœ„ì˜ ì¡°ê±´ì— ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ìˆ ì§€ì›ìœ¼ë¡œ ë¶„ë¥˜
        }
        
        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('loginError');

            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userWelcome').textContent = `${user.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤`;
                showPage('dashboard');
                errorElement.classList.add('hidden');
            } else {
                errorElement.textContent = 'ì˜ëª»ëœ ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.';
                errorElement.classList.remove('hidden');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            currentUser = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // í˜ì´ì§€ ì „í™˜
        function showPage(page) {
            ['dashboardPage', 'registerPage', 'listPage'].forEach(p => {
                document.getElementById(p).classList.add('hidden');
            });

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            document.getElementById(page + 'Page').classList.remove('hidden');
            if (event && event.target) {
                event.target.classList.add('active');
            }

            currentPage = page;

            if (page === 'dashboard') {
                updateFilterOptions();
                applyFilters();
            } else if (page === 'list') {
                updateRecordsList();
            }
        }

        // ì°¨íŠ¸ íƒ­ ì „í™˜
        function showChartTab(tabName) {
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.chart-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            event.target.classList.add('active');
            document.getElementById(tabName + 'ChartContainer').classList.remove('hidden');
            
            currentChartTab = tabName;
            updateSpecificChart(tabName);
        }

        // í†µê³„ íƒ­ ì „í™˜
        function showStatsTab(tabName) {
            document.querySelectorAll('.stats-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.stats-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            event.target.classList.add('active');
            document.getElementById(tabName + 'StatsContainer').classList.remove('hidden');
            
            currentStatsTab = tabName;
            updateDetailStats();
        }

        // ë“±ë¡ íƒ­ ì „í™˜
        function showRegisterTab(tabName) {
            document.querySelectorAll('.register-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.register-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            event.target.classList.add('active');
            document.getElementById(tabName + 'RegisterContent').classList.remove('hidden');
            
            currentRegisterTab = tabName;
        }

        // í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateFilterOptions() {
            const engineers = [...new Set(supportRecords.map(r => r.engineerName))].sort();
            const sites = [...new Set(supportRecords.map(r => r.siteName))].sort();
            
            const engineerSelect = document.getElementById('filterEngineer');
            const siteSelect = document.getElementById('filterSite');

            engineerSelect.innerHTML = '<option value="">ì „ì²´ ì—”ì§€ë‹ˆì–´</option>';
            engineers.forEach(engineer => {
                engineerSelect.innerHTML += `<option value="${engineer}">${engineer}</option>`;
            });

            siteSelect.innerHTML = '<option value="">ì „ì²´ ì‚¬ì´íŠ¸</option>';
            sites.forEach(site => {
                siteSelect.innerHTML += `<option value="${site}">${site}</option>`;
            });
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const keyword = document.getElementById('searchKeyword').value.toLowerCase();
            const engineerFilter = document.getElementById('filterEngineer').value;
            const siteFilter = document.getElementById('filterSite').value;
            const supportTypeFilter = document.getElementById('filterSupportType').value;
            const startDateFilter = document.getElementById('filterStartDate').value;
            const endDateFilter = document.getElementById('filterEndDate').value;

            filteredRecords = supportRecords.filter(record => {
                if (keyword && !record.siteName.toLowerCase().includes(keyword) && 
                    !record.engineerName.toLowerCase().includes(keyword)) {
                    return false;
                }
                if (engineerFilter && record.engineerName !== engineerFilter) return false;
                if (siteFilter && record.siteName !== siteFilter) return false;
                if (supportTypeFilter && record.supportType !== supportTypeFilter) return false;
                if (startDateFilter && record.startDate < startDateFilter) return false;
                if (endDateFilter && record.startDate > endDateFilter) return false;
                return true;
            });

            updateDashboard();
        }

        // í•„í„° ì´ˆê¸°í™”
        function clearFilters() {
            ['searchKeyword', 'filterEngineer', 'filterSite', 'filterSupportType', 'filterStartDate', 'filterEndDate'].forEach(id => {
                document.getElementById(id).value = '';
            });
            applyFilters();
        }

        // ì‹œê°„ ê³„ì‚°
        function calculateSupportHours(startDate, startTime, endDate, endTime) {
            if (!startDate || !startTime || !endDate || !endTime) return 0;
            
            const start = new Date(`${startDate}T${startTime}`);
            const end = new Date(`${endDate}T${endTime}`);
            const diffInMs = end - start;
            const diffInHours = diffInMs / (1000 * 60 * 60);
            
            return Math.max(0, diffInHours);
        }

        // ì‹¤ì‹œê°„ ì‹œê°„ ê³„ì‚° ì—…ë°ì´íŠ¸
        function updateCalculatedHours() {
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value;
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value;

            const hours = calculateSupportHours(startDate, startTime, endDate, endTime);
            document.getElementById('calculatedHours').textContent = hours.toFixed(1);
        }

        // **[ìƒˆë¡œìš´ í•¨ìˆ˜]** í˜„ì¬ ê¸°ë¡ì„ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
            function saveRecordsToLocalStorage() {
                try {
                    localStorage.setItem('supportRecords', JSON.stringify(supportRecords));
                    // console.log(`âœ… ${supportRecords.length}ê°œì˜ ê¸°ë¡ì„ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.`);
                } catch (e) {
                    console.error("ë¡œì»¬ ì €ì¥ì†Œì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
                    alert("ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì €ì¥ ê³µê°„ì´ ê°€ë“ ì°¼ê±°ë‚˜ ê°œì¸ ì •ë³´ ë³´í˜¸ ì„¤ì • ë•Œë¬¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                }
            }

        // ì§€ì› ê¸°ë¡ ì œì¶œ
        function handleSubmitSupport() {
            const siteName = document.getElementById('siteName').value;
            const engineerName = document.getElementById('engineerName').value;
            const supportType = document.getElementById('supportType').value;
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value;
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value;

            if (!siteName || !engineerName || !supportType || !startDate || !startTime || !endDate || !endTime) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const totalHours = calculateSupportHours(startDate, startTime, endDate, endTime);

            const record = {
                id: editingRecord ? editingRecord.id : Date.now(),
                siteName,
                engineerName,
                supportType,
                startDate,
                startTime,
                endDate,
                endTime,
                totalHours: totalHours.toFixed(1),
                createdAt: editingRecord ? editingRecord.createdAt : new Date().toISOString()
            };

            if (editingRecord) {
                const index = supportRecords.findIndex(r => r.id === record.id);
                supportRecords[index] = record;
            } else {
                supportRecords.push(record);
            }
            saveRecordsToLocalStorage();
            
            clearForm();
            alert(editingRecord ? 'ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ê¸°ë¡ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            showPage('list');
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            ['siteName', 'engineerName', 'supportType', 'startDate', 'startTime', 'endDate', 'endTime'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('calculatedHours').textContent = '0';
            
            editingRecord = null;
            document.getElementById('registerTitle').textContent = 'â• ì‚¬ì´íŠ¸ ì§€ì› ë“±ë¡';
            document.getElementById('submitBtn').textContent = 'ë“±ë¡';
            document.getElementById('cancelBtn').classList.add('hidden');
        }

        // ê¸°ë¡ í¸ì§‘
        function editRecord(id) {
            const record = supportRecords.find(r => r.id === id);
            if (!record) return;

            editingRecord = record;
            ['siteName', 'engineerName', 'supportType', 'startDate', 'startTime', 'endDate', 'endTime'].forEach(field => {
                document.getElementById(field).value = record[field];
            });
            
            updateCalculatedHours();
            
            document.getElementById('registerTitle').textContent = 'âœï¸ ì§€ì› ê¸°ë¡ ìˆ˜ì •';
            document.getElementById('submitBtn').textContent = 'ìˆ˜ì •';
            document.getElementById('cancelBtn').classList.remove('hidden');
            
            showPage('register');
        }

        // í¸ì§‘ ì·¨ì†Œ
        function handleCancelEdit() {
            clearForm();
        }

        // ê¸°ë¡ ì‚­ì œ
        function deleteRecord(id) {
            if (confirm('ì •ë§ë¡œ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                supportRecords = supportRecords.filter(r => r.id !== id);
                saveRecordsToLocalStorage();
                updateRecordsList();
                if (currentPage === 'dashboard') {
                    applyFilters();
                }
                alert('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê¸°ë¡ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateRecordsList() {
            const tbody = document.getElementById('recordsTableBody');
            const emptyState = document.getElementById('emptyState');

            if (supportRecords.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            tbody.innerHTML = supportRecords.map(record => `
                <tr>
                    <td>${record.siteName}</td>
                    <td>${record.engineerName}</td>
                    <td><span class="support-type-badge ${record.supportType}">${record.supportType}</span></td>
                    <td>${record.startDate} ${record.startTime}</td>
                    <td>${record.endDate} ${record.endTime}</td>
                    <td>${record.totalHours}h</td>
                    <td>
                        <button class="action-btn" onclick="editRecord(${record.id})" title="ìˆ˜ì •">âœï¸</button>
                        <button class="action-btn delete" onclick="deleteRecord(${record.id})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            updateStats();
            updateCharts();
            updateDetailStats();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const records = filteredRecords;
            const totalRecords = records.length;
            const totalHours = records.reduce((sum, record) => sum + parseFloat(record.totalHours), 0);
            const avgHours = totalRecords > 0 ? totalHours / totalRecords : 0;
            const activeEngineers = [...new Set(records.map(r => r.engineerName))].length;

            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('totalHours').textContent = totalHours.toFixed(1) + 'h';
            document.getElementById('avgHours').textContent = avgHours.toFixed(1) + 'h';
            document.getElementById('activeEngineers').textContent = activeEngineers;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            updateSpecificChart(currentChartTab);
        }

        // íŠ¹ì • ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateSpecificChart(chartType) {
            switch(chartType) {
                case 'monthly': updateMonthlyChart(); break;
                case 'engineer': updateEngineerChart(); break;
                case 'supporttype': updateSupportTypeChart(); break;
                case 'site': updateSiteChart(); break;
            }
        }

        // ì›”ê°„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateMonthlyChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            if (charts.monthly) charts.monthly.destroy();

            const monthlyData = {};
            filteredRecords.forEach(record => {
                const month = record.startDate.slice(0, 7);
                if (!monthlyData[month]) monthlyData[month] = {};
                if (!monthlyData[month][record.siteName]) monthlyData[month][record.siteName] = 0;
                monthlyData[month][record.siteName] += parseFloat(record.totalHours);
            });

            const months = Object.keys(monthlyData).sort();
            const sites = [...new Set(filteredRecords.map(r => r.siteName))];
            
            const datasets = sites.map((site, index) => ({
                label: site,
                data: months.map(month => monthlyData[month][site] || 0),
                backgroundColor: `hsl(${index * 60}, 70%, 60%)`,
                borderColor: `hsl(${index * 60}, 70%, 50%)`,
                borderWidth: 2,
                borderRadius: 5
            }));

            charts.monthly = new Chart(ctx, {
                type: 'bar',
                data: { labels: months, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'ì›”ê°„ ì‚¬ì´íŠ¸ë³„ ì§€ì› ì‹œê°„' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'ì§€ì› ì‹œê°„ (h)' } },
                        x: { title: { display: true, text: 'ì›”' } }
                    }
                }
            });
        }

        // ì—”ì§€ë‹ˆì–´ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateEngineerChart() {
            const ctx = document.getElementById('engineerChart').getContext('2d');
            
            if (charts.engineer) charts.engineer.destroy();

            const engineerData = {};
            filteredRecords.forEach(record => {
                if (!engineerData[record.engineerName]) {
                    engineerData[record.engineerName] = { hours: 0, count: 0 };
                }
                engineerData[record.engineerName].hours += parseFloat(record.totalHours);
                engineerData[record.engineerName].count++;
            });

            const engineers = Object.keys(engineerData);
            const totalHours = engineers.map(eng => engineerData[eng].hours.toFixed(1));
            const avgHours = engineers.map(eng => (engineerData[eng].hours / engineerData[eng].count).toFixed(1));

            charts.engineer = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: engineers,
                    datasets: [
                        {
                            label: 'ì´ ì§€ì› ì‹œê°„',
                            data: totalHours,
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'ì—”ì§€ë‹ˆì–´ë³„ ì§€ì› í†µê³„' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'ì‹œê°„ (h)' } }
                    }
                }
            });
        }

        // ì§€ì› íƒ€ì…ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateSupportTypeChart() {
            const ctx = document.getElementById('supportTypeChart').getContext('2d');
            
            if (charts.supporttype) charts.supporttype.destroy();

            const typeData = {};
            filteredRecords.forEach(record => {
                if (!typeData[record.supportType]) typeData[record.supportType] = 0;
                typeData[record.supportType] += parseFloat(record.totalHours);
            });

            const types = Object.keys(typeData);
            const hours = Object.values(typeData);
            const colors = ['#28a745', '#007bff', '#dc3545'];

            charts.supporttype = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: types,
                    datasets: [{
                        data: hours,
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: { display: true, text: 'ì§€ì› íƒ€ì…ë³„ ì‹œê°„ ë¶„í¬' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toFixed(1)}h (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì‚¬ì´íŠ¸ë³„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateSiteChart() {
            const ctx = document.getElementById('siteChart').getContext('2d');
            
            if (charts.site) charts.site.destroy();

            const siteData = {};
            filteredRecords.forEach(record => {
                if (!siteData[record.siteName]) siteData[record.siteName] = 0;
                siteData[record.siteName] += parseFloat(record.totalHours);
            });

            const sites = Object.keys(siteData);
            const hours = Object.values(siteData);
            const colors = sites.map((_, index) => `hsl(${index * 60}, 70%, 60%)`);

            charts.site = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: sites,
                    datasets: [{
                        data: hours,
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: { display: true, text: 'ì‚¬ì´íŠ¸ë³„ ì´ ì§€ì› ì‹œê°„ ë¶„í¬' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toFixed(1)}h (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ìƒì„¸ í†µê³„ ì—…ë°ì´íŠ¸
        function updateDetailStats() {
            switch(currentStatsTab) {
                case 'engineer': updateEngineerStats(); break;
                case 'site': updateSiteStats(); break;
                case 'supporttype': updateSupportTypeStats(); break;
            }
        }

        // ì—”ì§€ë‹ˆì–´ë³„ ìƒì„¸ í†µê³„
        function updateEngineerStats() {
            const tbody = document.getElementById('engineerStatsBody');
            const records = filteredRecords;

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #6c757d;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            const engineerStats = {};
            records.forEach(record => {
                const engineer = record.engineerName;
                if (!engineerStats[engineer]) {
                    engineerStats[engineer] = {
                        count: 0, totalHours: 0, ì •ê¸°ì ê²€: 0, ê¸°ìˆ ì§€ì›: 0, ì¥ì• ì§€ì›: 0
                    };
                }
                engineerStats[engineer].count++;
                engineerStats[engineer].totalHours += parseFloat(record.totalHours);
                engineerStats[engineer][record.supportType]++;
            });

            tbody.innerHTML = Object.keys(engineerStats).map(engineer => {
                const stat = engineerStats[engineer];
                const avgHours = stat.totalHours / stat.count;
                return `
                    <tr>
                        <td style="font-weight: 600; color: #667eea;">${engineer}</td>
                        <td>${stat.count}</td>
                        <td>${stat.totalHours.toFixed(1)}h</td>
                        <td>${avgHours.toFixed(1)}h</td>
                        <td>${stat.ì •ê¸°ì ê²€}</td>
                        <td>${stat.ê¸°ìˆ ì§€ì›}</td>
                        <td>${stat.ì¥ì• ì§€ì›}</td>
                    </tr>
                `;
            }).join('');
        }

        // ì‚¬ì´íŠ¸ë³„ ìƒì„¸ í†µê³„
        function updateSiteStats() {
            const tbody = document.getElementById('siteStatsBody');
            const records = filteredRecords;

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            const siteStats = {};
            records.forEach(record => {
                const site = record.siteName;
                if (!siteStats[site]) {
                    siteStats[site] = {
                        count: 0, totalHours: 0, engineers: new Set(), supportTypes: {}
                    };
                }
                siteStats[site].count++;
                siteStats[site].totalHours += parseFloat(record.totalHours);
                siteStats[site].engineers.add(record.engineerName);
                if (!siteStats[site].supportTypes[record.supportType]) {
                    siteStats[site].supportTypes[record.supportType] = 0;
                }
                siteStats[site].supportTypes[record.supportType]++;
            });

            tbody.innerHTML = Object.keys(siteStats).map(site => {
                const stat = siteStats[site];
                const avgHours = stat.totalHours / stat.count;
                const mainType = Object.keys(stat.supportTypes).reduce((a, b) => 
                    stat.supportTypes[a] > stat.supportTypes[b] ? a : b);
                return `
                    <tr>
                        <td style="font-weight: 600; color: #667eea;">${site}</td>
                        <td>${stat.count}</td>
                        <td>${stat.totalHours.toFixed(1)}h</td>
                        <td>${avgHours.toFixed(1)}h</td>
                        <td>${stat.engineers.size}ëª…</td>
                        <td><span class="support-type-badge ${mainType}">${mainType}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // ì§€ì› íƒ€ì…ë³„ ìƒì„¸ í†µê³„
        function updateSupportTypeStats() {
            const tbody = document.getElementById('supportTypeStatsBody');
            const records = filteredRecords;

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            const typeStats = {};
            records.forEach(record => {
                const type = record.supportType;
                if (!typeStats[type]) {
                    typeStats[type] = { count: 0, totalHours: 0, engineers: new Set() };
                }
                typeStats[type].count++;
                typeStats[type].totalHours += parseFloat(record.totalHours);
                typeStats[type].engineers.add(record.engineerName);
            });

            const totalRecords = records.length;
            tbody.innerHTML = Object.keys(typeStats).map(type => {
                const stat = typeStats[type];
                const avgHours = stat.totalHours / stat.count;
                const percentage = ((stat.count / totalRecords) * 100).toFixed(1);
                return `
                    <tr>
                        <td><span class="support-type-badge ${type}">${type}</span></td>
                        <td>${stat.count}</td>
                        <td>${stat.totalHours.toFixed(1)}h</td>
                        <td>${avgHours.toFixed(1)}h</td>
                        <td>${stat.engineers.size}ëª…</td>
                        <td>${percentage}%</td>
                    </tr>
                `;
            }).join('');
        }

        // ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadExcelTemplate() {
            const templateData = [
                ['ì‚¬ì´íŠ¸ëª…', 'ì—”ì§€ë‹ˆì–´ëª…', 'ì‹œì‘ë‚ ì§œ', 'ì‹œì‘ì‹œê°„', 'ì¢…ë£Œë‚ ì§œ', 'ì¢…ë£Œì‹œê°„', 'ì§€ì› íƒ€ì…', 'ì„¤ëª… (ì„ íƒ)'],
                ['Arctera', '[ì‹œì˜¤ë©] ê¸°ìˆ ì§€ì›ë³¸ë¶€ ì„ëª…ì—´', '2025-01-07', '09:30', '2025-01-07', '17:30', 'ì •ê¸°ì ê²€', 'ì •ê¸°ì ê²€ íšŒì˜'],
                ['ëŒ€ë¦¼ê·¸ë£¹', '[ì‹œì˜¤ë©] ì—”ì§€ë‹ˆì–´íŒ€ ì†ìš©ë½', '2025-01-08', '08:00', '2025-01-08', '16:00', 'ê¸°ìˆ ì§€ì›', 'í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜ ê¸°ìˆ  ì§€ì›'],
                ['KBêµ­ë¯¼ì€í–‰', '[ì‹œì˜¤ë©] ì—”ì§€ë‹ˆì–´íŒ€ ì—„ì •í˜„', '2025-01-09', '10:00', '2025-01-09', '18:00', 'ì¥ì• ì§€ì›', 'ë°±ì—… ì‹¤íŒ¨ë¡œ ì¸í•œ ì¥ì• ì§€ì›']
            ];

            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ì§€ì›ê¸°ë¡í…œí”Œë¦¿");
            
            ws['!cols'] = [
                {wch: 20}, {wch: 25}, {wch: 12}, {wch: 10}, {wch: 12}, {wch: 10}, {wch: 12}, {wch: 30}
            ];
            
            XLSX.writeFile(wb, "ì‚¬ì´íŠ¸ì§€ì›ê¸°ë¡_í…œí”Œë¦¿_2025.xlsx");
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
                return;
            }
            
            // íŒŒì¼ í™•ì¥ì í™•ì¸ ë° ì ì ˆí•œ íŒŒì‹± í•¨ìˆ˜ í˜¸ì¶œ
            const fileName = file.name.toLowerCase();
            const fileExtension = fileName.split('.').pop();

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    let parsedData;
                    
                    if (fileExtension === 'csv') {
                        // CSV íŒŒì¼ ì²˜ë¦¬ (Outlook í˜•ì‹ ì˜ˆìƒ)
                        parsedData = parseOutlookCsvData(data);
                    } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                        // ê¸°ì¡´ Excel íŒŒì¼ ì²˜ë¦¬
                        const workbook = XLSX.read(new Uint8Array(data), {type: 'array'});
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                        parsedData = parseGenericExcelData(jsonData);
                    } else {
                        alert('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. .xlsx, .xls, .csv íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.');
                        return;
                    }

                    if (parsedData.length === 0) {
                        alert('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    displayPreview(parsedData);

                } catch (error) {
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            
            if (fileExtension === 'csv') {
                // CSVëŠ” í…ìŠ¤íŠ¸ë¡œ ì½ìŒ
                reader.readAsText(file);
            } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                // Excelì€ ArrayBufferë¡œ ì½ìŒ
                reader.readAsArrayBuffer(file);
            }
        }
        
        // CSV ë°ì´í„° íŒŒì‹± (Outlook í˜•ì‹)
        function parseOutlookCsvData(csvString) {
            // CSV íŒŒì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ ê°„ë‹¨í•œ íŒŒì‹± (ì‰¼í‘œë¡œ ë¶„ë¦¬)
            const rows = csvString.trim().split('\n');
            if (rows.length < 2) return [];

            const headers = rows[0].trim().split(',').map(h => h.replace(/"/g, '').trim());
            const dataRows = rows.slice(1);

            // í•„ìš”í•œ ì—´ ì¸ë±ìŠ¤ ì°¾ê¸°
            const indices = {
                title: headers.indexOf('ì œëª©'),
                organizer: headers.indexOf('ëª¨ì„ ì´ëŒì´'),
                startDate: headers.indexOf('ì‹œì‘ ë‚ ì§œ'),
                startTime: headers.indexOf('ì‹œì‘ ì‹œê°„'),
                endDate: headers.indexOf('ë ë‚ ì§œ'),
                endTime: headers.indexOf('ë ì‹œê°„'),
                description: headers.indexOf('ì„¤ëª…')
            };

            const requiredIndices = ['title', 'organizer', 'startDate', 'startTime', 'endDate', 'endTime'];
            if (requiredIndices.some(key => indices[key] === -1)) {
                 alert("CSV íŒŒì¼ì—ì„œ 'ì œëª©', 'ëª¨ì„ ì´ëŒì´', 'ì‹œì‘ ë‚ ì§œ', 'ì‹œì‘ ì‹œê°„', 'ë ë‚ ì§œ', 'ë ì‹œê°„' ì—´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Outlook ì¼ì • CSV í˜•ì‹ì´ ë§ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
                 return [];
            }


            const validData = [];
            dataRows.forEach(row => {
                // ë”°ì˜´í‘œì™€ ì‰¼í‘œ ì²˜ë¦¬ê°€ ë³µì¡í•˜ë¯€ë¡œ ê°„ë‹¨íˆ ì‰¼í‘œë¡œ ë¶„ë¦¬ (ì •í™•ë„ë¥¼ ìœ„í•´ì„  íŒŒì„œ í•„ìš”)
                // í˜„ì¬ CSVëŠ” ê° í•„ë“œê°€ í°ë”°ì˜´í‘œë¡œ ë¬¶ì—¬ìˆê³ , í•„ë“œ ë‚´ ì¤„ë°”ê¿ˆì´ ìˆì–´ ì •ê·œì‹ìœ¼ë¡œ ì²˜ë¦¬
                // rows.slice(1)ì˜ ë°ì´í„°ë§Œ ì‚¬ìš©.
                
                // ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì—¬ í°ë”°ì˜´í‘œë¡œ ë¬¶ì¸ í•„ë“œì™€ ê·¸ë ‡ì§€ ì•Šì€ í•„ë“œë¥¼ ë¶„ë¦¬
                const fields = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || row.split(',');
                if (fields.length < headers.length) {
                    // í•„ë“œ ìˆ˜ê°€ ë¶€ì¡±í•˜ë©´ ê±´ë„ˆëœ€ (ì·¨ì†Œëœ ì¼ì • ë“±)
                    if(row.includes('ì·¨ì†Œë¨')) return; 
                }
                
                // í•„ë“œì—ì„œ í°ë”°ì˜´í‘œ ì œê±° ë° ì•ë’¤ ê³µë°± ì œê±°
                const cleanFields = fields.map(field => field.replace(/^"|"$/g, '').trim());


                const siteName = cleanFields[indices.title];
                let engineerName = cleanFields[indices.organizer];
                const startDate = cleanFields[indices.startDate];
                const startTimeRaw = cleanFields[indices.startTime];
                const endDate = cleanFields[indices.endDate];
                const endTimeRaw = cleanFields[indices.endTime];
                const description = cleanFields[indices.description];

                // ì—”ì§€ë‹ˆì–´ ì´ë¦„ì—ì„œ ì¡°ì§ ì •ë³´ ì œê±° (ì˜ˆ: [ì‹œì˜¤ë©] SCíŒ€ ê¹€ì¤€ê·œ -> ê¹€ì¤€ê·œ)
                if(engineerName) {
                    engineerName = engineerName.replace(/\[[^\]]+\]\s*/g, '').trim();
                } else {
                    engineerName = "ë¯¸ì •";
                }

                // ì‹œê°„ ë¬¸ìì—´ ì •ë¦¬ (ì˜ˆ: "ì˜¤ì „ 9:00:00" -> "09:00")
                const formatTime = (timeStr) => {
                    if (!timeStr) return '';
                    // 'ì˜¤ì „' ë˜ëŠ” 'ì˜¤í›„' ë° ì´ˆ ì œê±°. ì •ê·œì‹ìœ¼ë¡œ ì²˜ë¦¬.
                    let time = timeStr.replace(/.*?(\d+:\d+)(:\d+)?$/, '$1').trim();
                    if(time.length === 4) time = '0' + time; // '9:00' -> '09:00'
                    return time;
                };

                const startTime = formatTime(startTimeRaw);
                const endTime = formatTime(endTimeRaw);
                
                const supportType = classifySupportType(siteName + ' ' + description);
                const totalHours = calculateSupportHours(startDate, startTime, endDate, endTime);

                // ìœ íš¨ì„± ê²€ì‚¬ (ì´ ì‹œê°„ì´ 0ì´ ì•„ë‹ˆê³  í•„ìˆ˜ í•„ë“œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°)
                if (siteName && engineerName && startDate && endDate && totalHours > 0) {
                     validData.push({
                        siteName: siteName.replace(/^ì·¨ì†Œë¨: /g, '').trim(), // ì œëª©ì— ì·¨ì†Œë¨ì´ ìˆë‹¤ë©´ ì œê±°
                        engineerName: engineerName,
                        supportType: supportType,
                        startDate,
                        startTime,
                        endDate,
                        endTime,
                        totalHours: totalHours.toFixed(1)
                    });
                }
            });

            return validData;
        }

        // ì¼ë°˜ ì—‘ì…€ ë°ì´í„° íŒŒì‹± (ê¸°ì¡´ í…œí”Œë¦¿ í˜•ì‹)
        function parseGenericExcelData(jsonData) {
            if (jsonData.length < 2) return [];

            const headers = jsonData[0];
            const dataRows = jsonData.slice(1);
            
            const validData = [];
            dataRows.forEach(row => {
                if (row.length >= 7 && row[0] && row[1] && row[6]) {
                    const startDate = formatDateFromExcel(row[2]);
                    const startTime = formatTimeFromExcel(row[3]);
                    const endDate = formatDateFromExcel(row[4]);
                    const endTime = formatTimeFromExcel(row[5]);
                    
                    if (startDate && startTime && endDate && endTime) {
                        const totalHours = calculateSupportHours(startDate, startTime, endDate, endTime);
                        if(totalHours > 0) {
                            validData.push({
                                siteName: row[0].toString().trim(),
                                engineerName: row[1].toString().trim(),
                                supportType: row[6].toString().trim(),
                                startDate,
                                startTime,
                                endDate,
                                endTime,
                                totalHours: totalHours.toFixed(1)
                            });
                        }
                    }
                }
            });

            return validData;
        }

        // ì—‘ì…€ ë‚ ì§œ í˜•ì‹ ë³€í™˜
        function formatDateFromExcel(value) {
            if (!value) return '';
            
            if (typeof value === 'number') {
                const date = XLSX.SSF.parse_date_code(value);
                return `${date.y}-${String(date.m).padStart(2, '0')}-${String(date.d).padStart(2, '0')}`;
            }
            
            const dateStr = value.toString().trim();
            if (dateStr.includes('T')) {
                return dateStr.split('T')[0];
            }
            // YYYY-MM-DD í˜•ì‹ì´ ì´ë¯¸ ê°–ì¶°ì§„ ê²½ìš°
            if (/^\d{4}-\d{1,2}-\d{1,2}$/.test(dateStr)) {
                return dateStr;
            }
            
            return dateStr;
        }

        // ì—‘ì…€ ì‹œê°„ í˜•ì‹ ë³€í™˜
        function formatTimeFromExcel(value) {
            if (!value) return '';
            
            if (typeof value === 'number') {
                const totalMinutes = Math.round(value * 24 * 60);
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            }
            
            const timeStr = value.toString().trim();
            if (timeStr.includes('T')) {
                return timeStr.split('T')[1].substring(0, 5);
            }
            // HH:MM í˜•ì‹ì´ ì´ë¯¸ ê°–ì¶°ì§„ ê²½ìš°
            if (/^\d{1,2}:\d{1,2}(:\d{2})?$/.test(timeStr)) {
                return timeStr.substring(0, 5);
            }
            
            return timeStr;
        }

        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function displayPreview(data) {
            const previewSection = document.getElementById('previewSection');
            const previewTable = document.getElementById('previewTable');
            
            let tableHTML = `
                <div style="max-height: 400px; overflow: auto; border: 1px solid #e5e7eb; border-radius: 10px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 12px;">ì‚¬ì´íŠ¸ëª…</th>
                                <th style="padding: 12px;">ì—”ì§€ë‹ˆì–´ëª…</th>
                                <th style="padding: 12px;">ì§€ì› íƒ€ì…</th>
                                <th style="padding: 12px;">ì‹œì‘ì¼ì‹œ</th>
                                <th style="padding: 12px;">ì¢…ë£Œì¼ì‹œ</th>
                                <th style="padding: 12px;">ì´ ì‹œê°„</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            data.forEach((record, index) => {
                tableHTML += `
                    <tr style="border-bottom: 1px solid #e5e7eb; ${index % 2 === 0 ? 'background: #f9fafb;' : ''}">
                        <td style="padding: 10px;">${record.siteName}</td>
                        <td style="padding: 10px;">${record.engineerName}</td>
                        <td style="padding: 10px;"><span class="support-type-badge ${record.supportType}">${record.supportType}</span></td>
                        <td style="padding: 10px;">${record.startDate} ${record.startTime}</td>
                        <td style="padding: 10px;">${record.endDate} ${record.endTime}</td>
                        <td style="padding: 10px;">${record.totalHours}h</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table></div>';
            previewTable.innerHTML = tableHTML;
            previewSection.classList.remove('hidden');
            
            window.previewData = data;
        }

        // ì—‘ì…€ ë°ì´í„° ì²˜ë¦¬
        function processExcelData() {
            if (!window.previewData || window.previewData.length === 0) {
                alert('ì²˜ë¦¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!confirm(`ì´ ${window.previewData.length}ê°œì˜ ê¸°ë¡ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì·¨ì†Œëœ ì¼ì • ì œì™¸)`)) {
                return;
            }

            window.previewData.forEach(record => {
                supportRecords.push({
                    id: Date.now() + Math.random(),
                    ...record,
                    createdAt: new Date().toISOString()
                });
            });

            alert(`${window.previewData.length}ê°œì˜ ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            clearExcelData();
            showPage('list');
        }

        // ì—‘ì…€ ë°ì´í„° ì´ˆê¸°í™”
        function clearExcelData() {
            document.getElementById('excelFileInput').value = '';
            document.getElementById('previewSection').classList.add('hidden');
            window.previewData = null;
        }

        // JSON ë°ì´í„° ì €ì¥
        function saveDataToJSON() {
            if (supportRecords.length === 0) {
                showDataStatus('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                return;
            }

            const dataToSave = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                exportedBy: currentUser ? currentUser.name : 'Unknown',
                totalRecords: supportRecords.length,
                data: supportRecords
            };

            const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `site_support_data_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showDataStatus(`âœ… ì´ ${supportRecords.length}ê°œ ê¸°ë¡ì´ JSON íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // JSON ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadDataFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    if (!jsonData.data || !Array.isArray(jsonData.data)) {
                        throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ JSON íŒŒì¼ êµ¬ì¡°ì…ë‹ˆë‹¤.');
                    }

                    if (!confirm(`í˜„ì¬ ë°ì´í„°: ${supportRecords.length}ê°œ\në¶ˆëŸ¬ì˜¬ ë°ì´í„°: ${jsonData.data.length}ê°œ\n\nê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ëŒ€ì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        return;
                    }

                    supportRecords = jsonData.data;
                    filteredRecords = supportRecords.slice();

                    updateFilterOptions();
                    applyFilters();
                    updateRecordsList();

                    showDataStatus(`âœ… ${supportRecords.length}ê°œì˜ ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤.`, 'success');

                    if (currentPage !== 'dashboard') {
                        showPage('dashboard');
                    }

                } catch (error) {
                    showDataStatus('âŒ JSON íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };

            reader.readAsText(file);
            event.target.value = '';
        }

        // ë°ì´í„° ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showDataStatus(message, type) {
            const statusElement = document.getElementById('dataStatus');
            statusElement.textContent = message;
            statusElement.className = `data-status ${type}`;
            statusElement.classList.remove('hidden');

            setTimeout(() => {
                statusElement.classList.add('hidden');
            }, 5000);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            // ì—”í„°í‚¤ ë¡œê·¸ì¸
            ['username', 'password'].forEach(id => {
                document.getElementById(id).addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') handleLogin();
                });
            });

            // ì‹¤ì‹œê°„ ì‹œê°„ ê³„ì‚°
            ['startDate', 'startTime', 'endDate', 'endTime'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateCalculatedHours);
            });

            // ê²€ìƒ‰ ì‹¤ì‹œê°„ ì ìš©
            document.getElementById('searchKeyword').addEventListener('input', function() {
                clearTimeout(this.searchTimeout);
                this.searchTimeout = setTimeout(() => applyFilters(), 300);
            });

            // ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ì‹¤ì œ ì—‘ì…€ ë°ì´í„° ê¸°ë°˜)
            setTimeout(() => {
                if (supportRecords.length === 0) {
                    generateSampleData();
                }
            }, 1000);
        });

        // ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ì‹¤ì œ ì—‘ì…€ ë°ì´í„° ê¸°ë°˜)
        function generateSampleData() {
            const sampleRecords = [
                { id: 1, siteName: 'Arctera', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-07', startTime: '09:30', endDate: '2025-01-07', endTime: '17:30', totalHours: '8.0', createdAt: '2025-01-07T09:30:00.000Z' },
                { id: 2, siteName: 'ëŒ€ë¦¼ê·¸ë£¹', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '09:30', endDate: '2025-01-06', endTime: '14:30', totalHours: '5.0', createdAt: '2025-01-06T09:30:00.000Z' },
                { id: 3, siteName: 'ì¸ì¬INC', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-09', startTime: '10:00', endDate: '2025-01-10', endTime: '12:00', totalHours: '26.0', createdAt: '2025-01-09T09:30:00.000Z' },
                { id: 4, siteName: 'ì¼€ì´ë±…í¬', engineerName: 'ì„ëª…ì—´', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '12:00', endDate: '2025-01-07', endTime: '12:00', totalHours: '24.0', createdAt: '2025-01-06T07:30:00.000Z' },
                { id: 5, siteName: 'ëŒ€ë¦¼ê·¸ë£¹', engineerName: 'ì†ìš©ë½', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-07', startTime: '10:00', endDate: '2025-01-07', endTime: '13:30', totalHours: '3.5', createdAt: '2025-01-06T09:30:00.000Z' },
                { id: 6, siteName: 'KBêµ­ë¯¼ì€í–‰', engineerName: 'ì—„ì •í˜„', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-07', startTime: '10:00', endDate: '2025-01-07', endTime: '17:30', totalHours: '7.5', createdAt: '2025-01-06T09:30:00.000Z' },
                { id: 7, siteName: 'ëŒ€ë¦¼ê·¸ë£¹', engineerName: 'ì´ê²½ì§„', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '15:30', endDate: '2025-01-06', endTime: '16:30', totalHours: '1.0', createdAt: '2025-01-05T15:02:00.000Z' },
                { id: 8, siteName: 'KT êµ­ì œì „í™”íŠ¸ë˜í”½ë¶„ì„ì‹œìŠ¤í…œ', engineerName: 'ì—„ì •í˜„', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-06', startTime: '14:00', endDate: '2025-01-06', endTime: '16:30', totalHours: '2.5', createdAt: '2025-01-05T13:32:00.000Z' },
                { id: 9, siteName: 'ì„œìš¸ì‹ ìš©ë³´ì¦ì¬ë‹¨', engineerName: 'ì†ìš©ë½', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-07', startTime: '14:00', endDate: '2025-01-07', endTime: '15:00', totalHours: '1.0', createdAt: '2025-01-06T13:32:00.000Z' },
                { id: 10, siteName: 'KT Bizì†”ë£¨ì…˜í”Œë«í¼ìš´ìš©íŒ€', engineerName: 'ì—„ì •í˜„', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-08', startTime: '10:00', endDate: '2025-01-08', endTime: '11:00', totalHours: '1.0', createdAt: '2025-01-07T09:30:00.000Z' },
                { id: 11, siteName: 'GTX-A ë¯¼ìêµ¬ê°„', engineerName: 'ì†ìš©ë½', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-09', startTime: '09:00', endDate: '2025-01-09', endTime: '14:00', totalHours: '5.0', createdAt: '2025-01-08T08:30:00.000Z' },
                { id: 12, siteName: 'ë¡¯ë°ì¹´ë“œ', engineerName: 'ê¹€ì¤€ê·œ', supportType: 'ì¥ì• ì§€ì›', startDate: '2025-01-10', startTime: '14:30', endDate: '2025-01-10', endTime: '17:30', totalHours: '3.0', createdAt: '2025-01-14T13:32:00.000Z' },
                { id: 13, siteName: 'KT Tving', engineerName: 'ì—„ì •í˜„', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-09', startTime: '14:00', endDate: '2025-01-09', endTime: '15:30', totalHours: '1.5', createdAt: '2025-01-08T13:32:00.000Z' },
                { id: 14, siteName: 'KT CLOUD IPC', engineerName: 'ì—„ì •í˜„', supportType: 'ì •ê¸°ì ê²€', startDate: '2025-01-08', startTime: '14:00', endDate: '2025-01-08', endTime: '17:30', totalHours: '3.5', createdAt: '2025-01-07T13:32:00.000Z' },
                { id: 15, siteName: 'Arctera', engineerName: 'ë¯¸ì •', supportType: 'ê¸°ìˆ ì§€ì›', startDate: '2025-01-20', startTime: '14:00', endDate: '2025-01-20', endTime: '23:30', totalHours: '9.5', createdAt: '2025-01-19T13:32:00.000Z' }
            ];
            
            supportRecords = sampleRecords;
            filteredRecords = supportRecords.slice();
            
            if (currentPage === 'dashboard') {
                updateFilterOptions();
                applyFilters();
            }
            updateRecordsList();
        }
    </script>
</body>
</html>
